const a0_0x3b8d7c=a0_0x1fe4;(function(_0x21a1e8,_0x12d71d){const _0x2e3b5b=a0_0x1fe4,_0x55fabb=_0x21a1e8();while(!![]){try{const _0x375ec2=-parseInt(_0x2e3b5b(0x144))/0x1+parseInt(_0x2e3b5b(0x129))/0x2*(-parseInt(_0x2e3b5b(0x11f))/0x3)+parseInt(_0x2e3b5b(0x122))/0x4+-parseInt(_0x2e3b5b(0x136))/0x5*(-parseInt(_0x2e3b5b(0x146))/0x6)+parseInt(_0x2e3b5b(0x15b))/0x7+parseInt(_0x2e3b5b(0x131))/0x8+-parseInt(_0x2e3b5b(0x132))/0x9;if(_0x375ec2===_0x12d71d)break;else _0x55fabb['push'](_0x55fabb['shift']());}catch(_0x828c85){_0x55fabb['push'](_0x55fabb['shift']());}}}(a0_0x4576,0x18f9d));function a0_0x4576(){const _0x11aad7=['1h00m',']Không\x20tìm\x20thấy\x20coin','//div[contains(@class,\x20\x27tap-bottom\x20Slide-in-left\x27)]','NextRun','elementExistsByXPath','floor','Không\x20xử\x20lý\x20fullHp','67060KWDiaD','maxday','length',']Tìm\x20thấy\x20dailyLeft','readFile','tapElement','Không\x20tìm\x20thấy\x20coin','//i[contains(@class,\x27_close-icon\x27)]','en-GB','][Lỗi]:\x20','coin',']Tìm\x20thấy\x20coin:\x20','3uTMDUM','name','Iframe','134216kSqIWS','][click]Không\x20click\x20được\x20vào\x20',']Không\x20click\x20được\x20vào\x20closePopup','Không\x20tìm\x20thấy\x20dailyLeft',']không\x20Tìm\x20thấy\x20dailyLeft','utf8','javascript','208340osLWZu','dailyLeft',']Xử\x20lý\x20thoigianconlai\x20OK',']Không\x20xử\x20lý\x20fullHp','mainframe','][xuLyFullHp]:\x20','join','closePopup','851320QilIqH','570339cTUAaO','toLocaleTimeString','NextRunStamp','getTextByXPath','670jUGzsX','now','][autoTap]:\x20','split',']nextRunAt:\x20','dirname','][lamQuest]Làm\x20Quest\x20nè',']Vào\x20game\x20nè','\x20OK','switchFrame','-autoTap','][autotap]\x20Đang\x20chờ\x20tap\x20xong\x20','][click][Lỗi]:\x20','][lamQuest]:\x20','37693HEphJI',']Đã\x20tìm\x20thấy\x20iframe','7074SsLkFT','00h00m','load','Không\x20tìm\x20thấy\x20quest','updateData',']Không\x20tìm\x20thấy\x20iframe','error:\x20','quest','][lamQuest]Click\x20quest\x20OK','Không\x20tìm\x20thấy\x20coinTag','4h00m','Không\x20tìm\x20thấy\x20iframe','][click]Click\x20',']Click\x20closePopup\x20OK'];a0_0x4576=function(){return _0x11aad7;};return a0_0x4576();}import{log,json}from'../modules/logger.js';import a0_0x2a0732 from'path';import{fileURLToPath}from'url';import a0_0x4a1c23 from'fs/promises';const __filename=fileURLToPath(import.meta['url']),__dirname=a0_0x2a0732[a0_0x3b8d7c(0x13b)](__filename);export default async function (context,signal){const _0x49049d=a0_0x3b8d7c,choMs=ms=>new Promise(resolve=>setTimeout(resolve,ms)),{firstPage,bot,profileNameId,getAks,genlogin,http,browser,dataId,screenDataBuffer2,tasksDataBuffer2,taskIndex}=context;let currentPage=firstPage,subframe;const botName=bot[_0x49049d(0x120)];let screenData=new Int32Array(screenDataBuffer2),tasksData=new Int32Array(tasksDataBuffer2),demLoop=0x0,remainTime;const xpath={'closePopup':_0x49049d(0x11a),'dailyLeft':_0x49049d(0x156),'coin':'//div[contains(@class,\x20\x27content-top\x20Slide-in-top\x27)]','quest':'//p[text()=\x27Quest\x27]'};try{subframe=await vaoGame();if(!subframe){log(profileNameId,'['+botName+_0x49049d(0x14b),![]);throw new Error(_0x49049d(0x151));}log(profileNameId,'['+botName+']Vào\x20game\x20OK'),await delay(0x3e8);const closePopup=await genlogin['elementExistsByXPath'](profileNameId,subframe,xpath[_0x49049d(0x130)],0x3e8);if(closePopup){log(profileNameId,'['+botName+']tìm\x20thấy\x20closePopup'),await delay(0x3e8);const clicked=await click(xpath[_0x49049d(0x130)]);!clicked&&log(profileNameId,'['+botName+_0x49049d(0x124),![]),log(profileNameId,'['+botName+_0x49049d(0x153));}await delay(0x7d0);const dailyLeft=await genlogin['elementExistsByXPath'](profileNameId,subframe,xpath['dailyLeft'],0x3e8);if(!dailyLeft){log(profileNameId,'['+botName+_0x49049d(0x126),null,![]);throw new Error(_0x49049d(0x125));}log(profileNameId,'['+botName+_0x49049d(0x116),null,'i');const fullHp=await genlogin['getTextByXPath'](profileNameId,subframe,xpath[_0x49049d(0x12a)],0x7d0),kq10=await xuLyFullHp(fullHp);if(!kq10){log(profileNameId,'['+botName+_0x49049d(0x12c),null,![]);throw new Error(_0x49049d(0x15a));}if(kq10['tapElement']===_0x49049d(0x15c))return await http[_0x49049d(0x14a)](profileNameId,profileNameId,dataId,_0x49049d(0x15c)),log(profileNameId,'['+botName+']Đã\x20đạt\x20đến\x20hạn\x20ngày',null,'w'),!![];await http[_0x49049d(0x14a)](profileNameId,profileNameId,dataId,kq10[_0x49049d(0x118)]);kq10[_0x49049d(0x118)]===_0x49049d(0x15c)?remainTime=_0x49049d(0x150):remainTime=_0x49049d(0x154);remainTime=_0x49049d(0x147),autoTap(kq10['tapElement']);let maxAttempts=0x14,attempt=0x0;await new Promise(resolve=>{const checkTapStatus=async()=>{const _0x434e60=a0_0x1fe4;attempt++;if(attempt>maxAttempts){log(profileNameId,'['+botName+'][autoTap]\x20Đã\x20đạt\x20đến\x20số\x20lần\x20thử\x20tối\x20đa\x20'+attempt,null,'w'),resolve(null);return;}const fullHp=await genlogin['getTextByXPath'](profileNameId,subframe,xpath['dailyLeft'],0x7d0),kq10=await xuLyFullHp(fullHp);if(kq10[_0x434e60(0x118)]===_0x434e60(0x15c)){log(profileNameId,'['+botName+'][autoTap]\x20Đã\x20đạt\x20đến\x20hạn\x20ngày',null,'w'),resolve(null);return;}else{if(kq10[_0x434e60(0x118)]<=0x1e){log(profileNameId,'['+botName+'][autoTap]\x20Đã\x20tap\x20xong'),resolve(!![]);return;}}log(profileNameId,'['+botName+_0x434e60(0x141)+kq10[_0x434e60(0x118)]+'|'+attempt,null,'i'),setTimeout(checkTapStatus,0x1388);};checkTapStatus();}),await delay(0x7d0);const coinTag=await genlogin[_0x49049d(0x158)](profileNameId,subframe,xpath[_0x49049d(0x11d)],0x3e8);if(!coinTag){log(profileNameId,'['+botName+']không\x20Tìm\x20thấy\x20coinTag');throw new Error(_0x49049d(0x14f));}log(profileNameId,'['+botName+']Tìm\x20thấy\x20coinTag');const coin=await genlogin[_0x49049d(0x135)](profileNameId,subframe,xpath[_0x49049d(0x11d)],0x7d0);if(!coin){log(profileNameId,'['+botName+_0x49049d(0x155),![]);throw new Error(_0x49049d(0x119));}await http[_0x49049d(0x14a)](profileNameId,profileNameId,dataId,null,null,coin),log(profileNameId,'['+botName+_0x49049d(0x11e)+coin);const remainT=await thoigianconlai(remainTime);return!remainT&&log(profileNameId,'['+botName+']không\x20xử\x20lý\x20được\x20thoigianconlai',null,![]),log(profileNameId,'['+botName+_0x49049d(0x12b)),log(profileNameId,'['+botName+_0x49049d(0x13a)+remainT[_0x49049d(0x157)]),{'status':!![],'coin':coin,'nextRun':remainT[_0x49049d(0x157)],'nextRunStamp':remainT[_0x49049d(0x134)]};}catch(error){log(profileNameId,'['+botName+_0x49049d(0x11c)+error,![]);}async function vaoGame(){const _0x221137=_0x49049d;try{log(profileNameId,'['+botName+_0x221137(0x13d));const subframe0=await genlogin['switchFrame'](profileNameId,currentPage,getAks[_0x221137(0x121)],0x2710);if(!subframe0){log(profileNameId,'['+botName+']Không\x20tìm\x20thấy\x20iframe',![]);throw new Error('Không\x20tìm\x20thấy\x20iframe');}return log(profileNameId,'['+botName+_0x221137(0x145)),subframe0;}catch(error){return log(profileNameId,'['+botName+_0x221137(0x11c)+error,![]),null;}}async function raGame(){const _0x36168c=_0x49049d;try{log(profileNameId,'['+botName+']Ra\x20game\x20nè'),currentPage=genlogin[_0x36168c(0x13f)](profileNameId,currentPage,_0x36168c(0x12d),0x7d0);if(!currentPage){log(profileNameId,'['+botName+']Không\x20tìm\x20thấy\x20main\x20frame',![]);throw new Error('Không\x20tìm\x20thấy\x20main\x20frame');}return currentPage;}catch(error){return log(profileNameId,'['+botName+_0x36168c(0x11c)+error,![]),null;}}async function click(xpath){const _0x53516a=_0x49049d;try{await delay(0x3e8);const clicked=await genlogin['click'](profileNameId,subframe,{'xpath':xpath,'mainframe':currentPage,'browser':browser},0x3e8);await delay(0x3e8);if(!clicked)return log(profileNameId,'['+botName+_0x53516a(0x123)+xpath,null,![]),null;return log(profileNameId,'['+botName+_0x53516a(0x152)+xpath+_0x53516a(0x13e)),clicked;}catch(error){return log(profileNameId,'['+botName+_0x53516a(0x142)+error,null,![]),null;}}async function xuLyFullHp(fullHp){const _0x55ea91=_0x49049d;try{let fullhp0=fullHp['trim']()['replace'](/,/g,''),parts=fullhp0[_0x55ea91(0x139)]('\x20'),tapCountPart=parts[_0x55ea91(0x15d)]>=0x3?parseInt(parts[parts[_0x55ea91(0x15d)]-0x3]):null,dayleft=parts[_0x55ea91(0x15d)]>=0x4?parseInt(parts[0x3]):null,daylimit=parts[_0x55ea91(0x15d)]>=0x6?parseInt(parts[0x5]):null,tapElement=tapCountPart;return dayleft!==null&&dayleft<=0x0&&(tapElement=_0x55ea91(0x15c)),{'tapElement':tapElement,'dayleft':dayleft,'daylimit':daylimit};}catch(error){return log(profileNameId,'['+botName+_0x55ea91(0x12e)+error,null,![]),null;}}async function autoTap(tapElement){const _0x249507=_0x49049d;try{log(profileNameId,'['+botName+']Auto\x20tap\x20'+tapElement+'\x20nè');let codeAutoTap=await getFile(botName+_0x249507(0x140));return await genlogin[_0x249507(0x128)](profileNameId,subframe,codeAutoTap),log(profileNameId,'['+botName+']Auto\x20tap\x20'+tapElement+_0x249507(0x13e)),!![];}catch(error){return log(profileNameId,'['+botName+_0x249507(0x138)+error,null,![]),null;}}async function getFile(nameFile){const _0x88623c=_0x49049d;try{const filePath=a0_0x2a0732[_0x88623c(0x12f)](__dirname,'javascript',nameFile),code=await a0_0x4a1c23[_0x88623c(0x117)](filePath,_0x88623c(0x127));return code;}catch(e){log(profileNameId,_0x88623c(0x14c)+e['message'],null,![]);}}async function lamQuest(){const _0x3ec55a=_0x49049d;try{log(profileNameId,'['+botName+_0x3ec55a(0x13c));const kq10=await genlogin[_0x3ec55a(0x158)](profileNameId,subframe,xpath[_0x3ec55a(0x14d)],0x7d0);if(!kq10){log(profileNameId,'['+botName+'][lamQuest]Không\x20tìm\x20thấy\x20quest',![]);throw new Error(_0x3ec55a(0x149));}log(profileNameId,'['+botName+'][lamQuest]Tìm\x20thấy\x20quest');const clicked=await click(xpath[_0x3ec55a(0x14d)]);if(!clicked){log(profileNameId,'['+botName+'][lamQuest]Không\x20click\x20được\x20vào\x20quest',![]);throw new Error('Không\x20click\x20được\x20vào\x20quest');}return log(profileNameId,'['+botName+_0x3ec55a(0x14e)),!![];}catch(error){return log(profileNameId,'['+botName+_0x3ec55a(0x143)+error,null,![]),null;}}async function thoigianconlai(thoigianconlai){const _0x5da4a2=_0x49049d;try{log(profileNameId,'['+botName+'][thoigianconlai]:Xử\x20lý\x20gian\x20còn\x20lại\x20nè');let hour0=thoigianconlai[_0x5da4a2(0x139)]('h')[0x0],minute0=thoigianconlai['split']('h')[0x1][_0x5da4a2(0x139)]('m')[0x0],hour=parseInt(hour0),minutes=parseInt(minute0),seconds=parseInt(0x0),totalSeconds=parseInt(hour*0xe10+minutes*0x3c+seconds);const unixTime=Math[_0x5da4a2(0x159)](Date[_0x5da4a2(0x137)]()/0x3e8),newUnixTime=unixTime+totalSeconds,newDate=new Date(newUnixTime*0x3e8),formattedDate=newDate['toLocaleDateString'](),formattedTime=newDate[_0x5da4a2(0x133)](_0x5da4a2(0x11b),{'hour12':![]});let NextRun=formattedDate+'\x20'+formattedTime;return{'NextRun':NextRun,'NextRunStamp':newUnixTime};}catch(error){return log(profileNameId,'['+botName+'][thoigianconlai]:\x20'+error,null,![]),null;}}async function delay(ms){return new Promise(async resolve=>{setTimeout(resolve,ms);});}async function cTimeout(){const _0x3320f8=_0x49049d;if(Atomics[_0x3320f8(0x148)](tasksData,taskIndex)===0x1)return!![];return![];}}function a0_0x1fe4(_0x2dc55c,_0x1630bb){const _0x4576b8=a0_0x4576();return a0_0x1fe4=function(_0x1fe43f,_0x1089b1){_0x1fe43f=_0x1fe43f-0x116;let _0x50dfd1=_0x4576b8[_0x1fe43f];return _0x50dfd1;},a0_0x1fe4(_0x2dc55c,_0x1630bb);};