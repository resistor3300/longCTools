const a0_0x4cba18=a0_0x499e;function a0_0x5087(){const _0x2405f9=['143473AGdcod','336962VrNzol',']Tìm\x20thấy\x20coin:\x20',']tìm\x20thấy\x20closePopup','][autoTap]:\x20',']Tìm\x20thấy\x20coinTag','now','\x20nè',']không\x20xử\x20lý\x20được\x20thoigianconlai','Không\x20tìm\x20thấy\x20quest',']Không\x20tìm\x20thấy\x20main\x20frame','4h00m',']Vào\x20game\x20OK','][autoTap]\x20Đã\x20đạt\x20đến\x20số\x20lần\x20thử\x20tối\x20đa\x20','getTextByXPath','tapElement','][thoigianconlai]:\x20',']Xử\x20lý\x20thoigianconlai\x20OK',']Click\x20closePopup\x20OK','en-GB','][thoigianconlai]:Xử\x20lý\x20gian\x20còn\x20lại\x20nè','][autotap]\x20Đang\x20chờ\x20tap\x20xong\x20','//p[text()=\x27Quest\x27]','utf8','closePopup','][lamQuest]Không\x20tìm\x20thấy\x20quest',']Không\x20xử\x20lý\x20fullHp','trim','toLocaleTimeString','4321680duQoQs','message','url','][lamQuest]Làm\x20Quest\x20nè',']Tìm\x20thấy\x20dailyLeft','updateData',']Đã\x20đạt\x20đến\x20hạn\x20ngày','length','maxday','load','][lamQuest]:\x20','196430xTQIHs',']Ra\x20game\x20nè',']Không\x20tìm\x20thấy\x20iframe','quest','6537yiXIAI','elementExistsByXPath','][autoTap]\x20Đã\x20tap\x20xong','switchFrame','\x20OK',']Auto\x20tap\x20','7976925AviZhu','//i[contains(@class,\x27_close-icon\x27)]',']Vào\x20game\x20nè','][lamQuest]Click\x20quest\x20OK','][xuLyFullHp]:\x20','click','javascript','42LPtquA','][Lỗi]:\x20','36LOzoVw','split','Không\x20click\x20được\x20vào\x20quest','Không\x20xử\x20lý\x20fullHp','51499rEmnHA','coin','3vjbXrK','][click]Không\x20click\x20được\x20vào\x20','NextRunStamp','dailyLeft','replace','][click]Click\x20','944KPQKra','join','Không\x20tìm\x20thấy\x20main\x20frame','512DDSBmH','NextRun','Iframe','Không\x20tìm\x20thấy\x20iframe',']Không\x20click\x20được\x20vào\x20closePopup',']nextRunAt:\x20',']Đã\x20tìm\x20thấy\x20iframe','][autoTap]\x20Đã\x20đạt\x20đến\x20hạn\x20ngày'];a0_0x5087=function(){return _0x2405f9;};return a0_0x5087();}(function(_0x316e0f,_0x38d094){const _0x592366=a0_0x499e,_0x12d410=_0x316e0f();while(!![]){try{const _0x316eb9=parseInt(_0x592366(0x166))/0x1*(-parseInt(_0x592366(0x178))/0x2)+parseInt(_0x592366(0x1a3))/0x3*(-parseInt(_0x592366(0x16c))/0x4)+-parseInt(_0x592366(0x19f))/0x5*(parseInt(_0x592366(0x15e))/0x6)+-parseInt(_0x592366(0x164))/0x7*(-parseInt(_0x592366(0x16f))/0x8)+parseInt(_0x592366(0x1a9))/0x9+parseInt(_0x592366(0x194))/0xa+parseInt(_0x592366(0x177))/0xb*(-parseInt(_0x592366(0x160))/0xc);if(_0x316eb9===_0x38d094)break;else _0x12d410['push'](_0x12d410['shift']());}catch(_0xda3cd8){_0x12d410['push'](_0x12d410['shift']());}}}(a0_0x5087,0x6f363));import{log,json}from'../modules/logger.js';import a0_0x306c3b from'path';import{fileURLToPath}from'url';function a0_0x499e(_0x73ecf,_0xe28b97){const _0x5087c0=a0_0x5087();return a0_0x499e=function(_0x499e76,_0x1880d5){_0x499e76=_0x499e76-0x15d;let _0x1f5b5e=_0x5087c0[_0x499e76];return _0x1f5b5e;},a0_0x499e(_0x73ecf,_0xe28b97);}import a0_0x5519ab from'fs/promises';const __filename=fileURLToPath(import.meta[a0_0x4cba18(0x196)]),__dirname=a0_0x306c3b['dirname'](__filename);export default async function (context,signal){const _0x364d96=a0_0x4cba18,choMs=ms=>new Promise(resolve=>setTimeout(resolve,ms)),{firstPage,bot,profileNameId,getAks,genlogin,http,browser,dataId,screenDataBuffer2,tasksDataBuffer2,taskIndex}=context;let currentPage=firstPage,subframe;const botName=bot['name'];let screenData=new Int32Array(screenDataBuffer2),tasksData=new Int32Array(tasksDataBuffer2),demLoop=0x0,remainTime;const xpath={'closePopup':_0x364d96(0x1aa),'dailyLeft':'//div[contains(@class,\x20\x27tap-bottom\x20Slide-in-left\x27)]','coin':'//div[contains(@class,\x20\x27content-top\x20Slide-in-top\x27)]','quest':_0x364d96(0x18d)};try{subframe=await vaoGame();if(!subframe){log(profileNameId,'['+botName+_0x364d96(0x1a1),![]);throw new Error('Không\x20tìm\x20thấy\x20iframe');}log(profileNameId,'['+botName+_0x364d96(0x183)),await delay(0x3e8);const closePopup=await genlogin[_0x364d96(0x1a4)](profileNameId,subframe,xpath[_0x364d96(0x18f)],0x3e8);if(closePopup){log(profileNameId,'['+botName+_0x364d96(0x17a)),await delay(0x3e8);const clicked=await click(xpath[_0x364d96(0x18f)]);!clicked&&log(profileNameId,'['+botName+_0x364d96(0x173),![]),log(profileNameId,'['+botName+_0x364d96(0x189));}await delay(0x7d0);const dailyLeft=await genlogin[_0x364d96(0x1a4)](profileNameId,subframe,xpath[_0x364d96(0x169)],0x3e8);if(!dailyLeft){log(profileNameId,'['+botName+']không\x20Tìm\x20thấy\x20dailyLeft',null,![]);throw new Error('Không\x20tìm\x20thấy\x20dailyLeft');}log(profileNameId,'['+botName+_0x364d96(0x198),null,'i');const fullHp=await genlogin['getTextByXPath'](profileNameId,subframe,xpath[_0x364d96(0x169)],0x7d0),kq10=await xuLyFullHp(fullHp);if(!kq10){log(profileNameId,'['+botName+_0x364d96(0x191),null,![]);throw new Error(_0x364d96(0x163));}kq10['tapElement']===_0x364d96(0x19c)&&(await http[_0x364d96(0x199)](profileNameId,profileNameId,dataId,_0x364d96(0x19c)),log(profileNameId,'['+botName+_0x364d96(0x19a),null,'w'));await http['updateData'](profileNameId,profileNameId,dataId,kq10[_0x364d96(0x186)]);if(kq10[_0x364d96(0x186)]===_0x364d96(0x19c))remainTime=_0x364d96(0x182);else{remainTime='1h00m',autoTap(kq10[_0x364d96(0x186)]);let maxAttempts=0x14,attempt=0x0;await new Promise(resolve=>{const checkTapStatus=async()=>{const _0x2bf256=a0_0x499e;attempt++;if(attempt>maxAttempts){log(profileNameId,'['+botName+_0x2bf256(0x184)+attempt,null,'w'),resolve(null);return;}const fullHp=await genlogin[_0x2bf256(0x185)](profileNameId,subframe,xpath[_0x2bf256(0x169)],0x7d0),kq10=await xuLyFullHp(fullHp);if(kq10['tapElement']===_0x2bf256(0x19c)){log(profileNameId,'['+botName+_0x2bf256(0x176),null,'w'),resolve(null);return;}else{if(kq10[_0x2bf256(0x186)]<=0x1e){log(profileNameId,'['+botName+_0x2bf256(0x1a5)),resolve(!![]);return;}}log(profileNameId,'['+botName+_0x2bf256(0x18c)+kq10[_0x2bf256(0x186)]+'|'+attempt,null,'i'),setTimeout(checkTapStatus,0x1388);};checkTapStatus();}),await delay(0x7d0);}const coinTag=await genlogin[_0x364d96(0x1a4)](profileNameId,subframe,xpath[_0x364d96(0x165)],0x3e8);!coinTag?log(profileNameId,'['+botName+']không\x20Tìm\x20thấy\x20coinTag',null,![]):log(profileNameId,'['+botName+_0x364d96(0x17c));const coin=await genlogin[_0x364d96(0x185)](profileNameId,subframe,xpath['coin'],0x7d0);!coin?log(profileNameId,'['+botName+']Không\x20tìm\x20thấy\x20coin',null,![]):(await http[_0x364d96(0x199)](profileNameId,profileNameId,dataId,null,null,coin),log(profileNameId,'['+botName+_0x364d96(0x179)+coin));const remainT=await thoigianconlai(remainTime);return!remainT&&log(profileNameId,'['+botName+_0x364d96(0x17f),null,![]),log(profileNameId,'['+botName+_0x364d96(0x188)),log(profileNameId,'['+botName+_0x364d96(0x174)+remainT['NextRun']),{'status':!![],'coin':coin,'nextRun':remainT[_0x364d96(0x170)],'nextRunStamp':remainT[_0x364d96(0x168)]};}catch(error){log(profileNameId,'['+botName+_0x364d96(0x15f)+error,![]);}async function vaoGame(){const _0x27a39b=_0x364d96;try{log(profileNameId,'['+botName+_0x27a39b(0x1ab));const subframe0=await genlogin[_0x27a39b(0x1a6)](profileNameId,currentPage,getAks[_0x27a39b(0x171)],0x2710);if(!subframe0){log(profileNameId,'['+botName+_0x27a39b(0x1a1),![]);throw new Error(_0x27a39b(0x172));}return log(profileNameId,'['+botName+_0x27a39b(0x175)),subframe0;}catch(error){return log(profileNameId,'['+botName+_0x27a39b(0x15f)+error,![]),null;}}async function raGame(){const _0x35a2ff=_0x364d96;try{log(profileNameId,'['+botName+_0x35a2ff(0x1a0)),currentPage=genlogin[_0x35a2ff(0x1a6)](profileNameId,currentPage,'mainframe',0x7d0);if(!currentPage){log(profileNameId,'['+botName+_0x35a2ff(0x181),![]);throw new Error(_0x35a2ff(0x16e));}return currentPage;}catch(error){return log(profileNameId,'['+botName+_0x35a2ff(0x15f)+error,![]),null;}}async function click(xpath){const _0x50d33f=_0x364d96;try{await delay(0x3e8);const clicked=await genlogin[_0x50d33f(0x1ae)](profileNameId,subframe,{'xpath':xpath,'mainframe':currentPage,'browser':browser},0x3e8);await delay(0x3e8);if(!clicked)return log(profileNameId,'['+botName+_0x50d33f(0x167)+xpath,null,![]),null;return log(profileNameId,'['+botName+_0x50d33f(0x16b)+xpath+_0x50d33f(0x1a7)),clicked;}catch(error){return log(profileNameId,'['+botName+'][click][Lỗi]:\x20'+error,null,![]),null;}}async function xuLyFullHp(fullHp){const _0x1de617=_0x364d96;try{let fullhp0=fullHp[_0x1de617(0x192)]()[_0x1de617(0x16a)](/,/g,''),parts=fullhp0[_0x1de617(0x161)]('\x20'),tapCountPart=parts[_0x1de617(0x19b)]>=0x3?parseInt(parts[parts[_0x1de617(0x19b)]-0x3]):null,dayleft=parts[_0x1de617(0x19b)]>=0x4?parseInt(parts[0x3]):null,daylimit=parts[_0x1de617(0x19b)]>=0x6?parseInt(parts[0x5]):null,tapElement=tapCountPart;return dayleft!==null&&dayleft<=0x0&&(tapElement=_0x1de617(0x19c)),{'tapElement':tapElement,'dayleft':dayleft,'daylimit':daylimit};}catch(error){return log(profileNameId,'['+botName+_0x1de617(0x1ad)+error,null,![]),null;}}async function autoTap(tapElement){const _0x467197=_0x364d96;try{log(profileNameId,'['+botName+']Auto\x20tap\x20'+tapElement+_0x467197(0x17e));let codeAutoTap=await getFile(botName+'-autoTap');return await genlogin['javascript'](profileNameId,subframe,codeAutoTap),log(profileNameId,'['+botName+_0x467197(0x1a8)+tapElement+'\x20OK'),!![];}catch(error){return log(profileNameId,'['+botName+_0x467197(0x17b)+error,null,![]),null;}}async function getFile(nameFile){const _0x53706c=_0x364d96;try{const filePath=a0_0x306c3b[_0x53706c(0x16d)](__dirname,_0x53706c(0x15d),nameFile),code=await a0_0x5519ab['readFile'](filePath,_0x53706c(0x18e));return code;}catch(e){log(profileNameId,'error:\x20'+e[_0x53706c(0x195)],null,![]);}}async function lamQuest(){const _0x4fa55b=_0x364d96;try{log(profileNameId,'['+botName+_0x4fa55b(0x197));const kq10=await genlogin[_0x4fa55b(0x1a4)](profileNameId,subframe,xpath[_0x4fa55b(0x1a2)],0x7d0);if(!kq10){log(profileNameId,'['+botName+_0x4fa55b(0x190),![]);throw new Error(_0x4fa55b(0x180));}log(profileNameId,'['+botName+'][lamQuest]Tìm\x20thấy\x20quest');const clicked=await click(xpath[_0x4fa55b(0x1a2)]);if(!clicked){log(profileNameId,'['+botName+'][lamQuest]Không\x20click\x20được\x20vào\x20quest',![]);throw new Error(_0x4fa55b(0x162));}return log(profileNameId,'['+botName+_0x4fa55b(0x1ac)),!![];}catch(error){return log(profileNameId,'['+botName+_0x4fa55b(0x19e)+error,null,![]),null;}}async function thoigianconlai(thoigianconlai){const _0x1ebbcc=_0x364d96;try{log(profileNameId,'['+botName+_0x1ebbcc(0x18b));let hour0=thoigianconlai[_0x1ebbcc(0x161)]('h')[0x0],minute0=thoigianconlai[_0x1ebbcc(0x161)]('h')[0x1]['split']('m')[0x0],hour=parseInt(hour0),minutes=parseInt(minute0),seconds=parseInt(0x0),totalSeconds=parseInt(hour*0xe10+minutes*0x3c+seconds);const unixTime=Math['floor'](Date[_0x1ebbcc(0x17d)]()/0x3e8),newUnixTime=unixTime+totalSeconds,newDate=new Date(newUnixTime*0x3e8),formattedDate=newDate['toLocaleDateString'](),formattedTime=newDate[_0x1ebbcc(0x193)](_0x1ebbcc(0x18a),{'hour12':![]});let NextRun=formattedDate+'\x20'+formattedTime;return{'NextRun':NextRun,'NextRunStamp':newUnixTime};}catch(error){return log(profileNameId,'['+botName+_0x1ebbcc(0x187)+error,null,![]),null;}}async function delay(ms){return new Promise(async resolve=>{setTimeout(resolve,ms);});}async function cTimeout(){const _0x13f47a=_0x364d96;if(Atomics[_0x13f47a(0x19d)](tasksData,taskIndex)===0x1)return!![];return![];}};