const a31_0x477724=a31_0x2694;(function(_0x1ed9a2,_0x59afe0){const _0x37af8=a31_0x2694,_0x5c3e56=_0x1ed9a2();while(!![]){try{const _0x310746=parseInt(_0x37af8(0x232))/0x1+parseInt(_0x37af8(0x23c))/0x2+parseInt(_0x37af8(0x225))/0x3+-parseInt(_0x37af8(0x21c))/0x4*(-parseInt(_0x37af8(0x207))/0x5)+-parseInt(_0x37af8(0x21e))/0x6+parseInt(_0x37af8(0x1e6))/0x7+-parseInt(_0x37af8(0x1f3))/0x8*(parseInt(_0x37af8(0x226))/0x9);if(_0x310746===_0x59afe0)break;else _0x5c3e56['push'](_0x5c3e56['shift']());}catch(_0x2e3c77){_0x5c3e56['push'](_0x5c3e56['shift']());}}}(a31_0x4b6e,0xea9f0),require('dotenv')[a31_0x477724(0x1eb)]());const {Worker,parentPort}=require(a31_0x477724(0x210)),{log,json}=require(a31_0x477724(0x22a)),Genlogin=require('./modules/Genlogin'),httpPost=require('./modules/http'),path=require(a31_0x477724(0x20e)),PQueue=require(a31_0x477724(0x221))[a31_0x477724(0x223)],gameQueue=new PQueue({'concurrency':0x2});let genlogin,profileNameId,profileId,browser,dataId;function a31_0x2694(_0x16cdca,_0x3e5267){const _0x4b6eb5=a31_0x4b6e();return a31_0x2694=function(_0x2694fd,_0x25f1f8){_0x2694fd=_0x2694fd-0x1d6;let _0x4bb33a=_0x4b6eb5[_0x2694fd];return _0x4bb33a;},a31_0x2694(_0x16cdca,_0x3e5267);}const timGame=!![];genlogin=new Genlogin('',!![]);const http=new httpPost(process['env'][a31_0x477724(0x243)],process[a31_0x477724(0x1f5)][a31_0x477724(0x208)],!![]);let signal={'aborted':![]};parentPort['on']('message',async({profile:_0x556249})=>{const _0x236718=a31_0x477724;try{if(_0x556249==_0x236718(0x21d))signal[_0x236718(0x1d7)]=!![],log(_0x236718(0x216),null,'w');else{if(signal[_0x236718(0x1d7)])throw new Error('timeout');log('[\x27worker-api3]['+_0x556249+_0x236718(0x1e5),null,'w');const _0x18eda3=await xuLyProfile(_0x556249);!_0x18eda3?(log(_0x236718(0x1d6)+_0x556249+_0x236718(0x1dc),null,'w'),parentPort[_0x236718(0x242)]({'success':![],'result':_0x18eda3})):(log('[xuLyProfile]:\x20Xử\x20lý\x20profile\x20'+_0x556249+_0x236718(0x1f7),null,'i'),parentPort[_0x236718(0x242)]({'success':!![],'result':_0x18eda3}));}}catch(_0x383c4e){parentPort[_0x236718(0x242)]({'success':![],'error':{'message':_0x383c4e[_0x236718(0x21a)],'stack':_0x383c4e[_0x236718(0x21b)]}});}});async function xuLyProfile(_0x529427){const _0x4ac203=a31_0x477724;try{if(signal[_0x4ac203(0x1d7)]){log(_0x4ac203(0x1d8),null,'w');throw new Error(_0x4ac203(0x21d));}profileNameId=_0x529427,log(_0x4ac203(0x201)+JSON[_0x4ac203(0x1e3)](_0x529427),null,'i');const _0x305929=await xuLyBrowser(_0x529427);return!_0x305929?(log(_0x4ac203(0x217)+_0x529427+_0x4ac203(0x1e2),null,'w'),null):(log(_0x4ac203(0x217)+_0x529427+_0x4ac203(0x1f7)),!![]);}catch(_0x3850ca){throw new Error(_0x4ac203(0x229)+_0x3850ca[_0x4ac203(0x21a)]);}}async function xuLyEndPoint(_0x3f8a00){const _0x141902=a31_0x477724;try{if(signal[_0x141902(0x1d7)]){log(_0x141902(0x1d8),null,'w');throw new Error(_0x141902(0x21d));}const _0x24e71a=_0x3f8a00[_0x141902(0x231)]('-')[0x1];profileId=_0x24e71a;let {wsEndpoint:_0x16fac5}=await genlogin[_0x141902(0x1ea)](_0x24e71a);if(signal['aborted']){log(_0x141902(0x1d8),null,'w');throw new Error('timeout');}log(_0x141902(0x1f4)+json(_0x16fac5),null,'i');if(!_0x16fac5){log(_0x141902(0x1d9)+_0x24e71a+_0x141902(0x1db),null,'i'),await genlogin[_0x141902(0x1de)](_0x24e71a);for(let _0x4a0a26=0x0;_0x4a0a26<0x5;_0x4a0a26++){if(signal[_0x141902(0x1d7)]){log(_0x141902(0x1d8),null,'w');throw new Error(_0x141902(0x21d));}log(_0x141902(0x240)+(_0x4a0a26+0x1)+_0x141902(0x224),null,'i'),await delay(0x1388);if(signal[_0x141902(0x1d7)]){log('[xuLyProfile]:đã\x20bị\x20hủy',null,'w');throw new Error(_0x141902(0x21d));}({wsEndpoint:_0x16fac5}=await genlogin[_0x141902(0x1ea)](_0x24e71a));if(signal[_0x141902(0x1d7)]){log(_0x141902(0x1d8),null,'w');throw new Error('timeout');}if(_0x16fac5){log(_0x141902(0x214)+_0x16fac5);break;}}if(!_0x16fac5)return log(_0x141902(0x1e9),null,![]),![];}const _0x30d739=_0x3f8a00;return await delay(0xbb8),log(_0x141902(0x241),null,'i'),log(_0x141902(0x1f4)+_0x16fac5,null,'i'),_0x16fac5;}catch(_0x16d22c){log(_0x141902(0x21f)+_0x16d22c,null,![]);}}async function xuLyBrowser(_0x2037ed){const _0x56183b=a31_0x477724;try{if(signal[_0x56183b(0x1d7)]){log(_0x56183b(0x1ec),null,'w');throw new Error(_0x56183b(0x21d));}let _0x238c1b=0x0;const _0x496cb3=await http['getBotAll'](profileNameId);if(!_0x496cb3){log('[xuLyBrowser]:\x20Bot\x20không\x20tìm\x20thấy',null,![]);throw new Error('No\x20bot\x20found');}if(_0x496cb3['length']<=0x0){log('[xuLyBrowser]:\x20không\x20lấy\x20được\x20bot',null,![]);throw new Error(_0x56183b(0x23d));}for(const _0x576d71 of _0x496cb3){if(signal[_0x56183b(0x1d7)]){log(_0x56183b(0x1ec),null,'w');throw new Error(_0x56183b(0x21d));}if(_0x576d71){if(_0x576d71['value']===_0x56183b(0x20b)){log('['+profileNameId+']:\x20XONG\x201\x20LƯỢT',null,'i');break;}if(!_0x576d71[_0x56183b(0x209)]){log('['+profileNameId+_0x56183b(0x22f)+json(_0x576d71)+_0x56183b(0x220),null,![]);continue;}if(_0x576d71[_0x56183b(0x1fb)]==='0'){log('['+profileNameId+']:\x20Bot\x20'+json(_0x576d71[_0x56183b(0x1fe)])+_0x56183b(0x249),null,![]);continue;}const _0x570931=await genlogin['nowTime']();if(_0x576d71[_0x56183b(0x1f1)]>_0x570931[_0x56183b(0x213)]){log('['+profileNameId+_0x56183b(0x22f)+json(_0x576d71[_0x56183b(0x1fe)])+'\x20Chưa\x20tới\x20giờ\x20chạy',null,'w');continue;}switch(_0x576d71[_0x56183b(0x209)]){case'A':log('['+profileNameId+_0x56183b(0x1ef)+json(_0x576d71['name'])+_0x56183b(0x215)),await xuLyGame(_0x576d71,'A');break;case'K':log('['+profileNameId+']:\x20'+json(_0x576d71['name'])+_0x56183b(0x1f9)),await xuLyGame(_0x576d71,'K');break;case'W':log('['+profileNameId+_0x56183b(0x1ef)+json(_0x576d71[_0x56183b(0x1fe)])+_0x56183b(0x20d)),await xuLyGame(_0x576d71,'W');break;default:log('['+profileNameId+_0x56183b(0x1ee)+json(_0x576d71[_0x56183b(0x209)]),null,![]);break;}log(_0x56183b(0x1df));}}return!![];}catch(_0x3c10f4){return log(_0x56183b(0x233)+_0x3c10f4,null,![]),log(_0x56183b(0x238)+json(bots),null,![]),null;}}async function xuLyGame(_0x3f1d9a,_0x39018e){const _0x38d080=a31_0x477724;try{if(signal[_0x38d080(0x1d7)]){log(_0x38d080(0x22c),null,'w');throw new Error(_0x38d080(0x21d));}if(_0x3f1d9a[_0x38d080(0x20c)]==='api'){log('[xuLyGame]:\x20'+_0x3f1d9a[_0x38d080(0x1fe)]+_0x38d080(0x1e1),null,'i');const _0x771932=await genlogin[_0x38d080(0x204)](),_0x1e22b0=await http[_0x38d080(0x22e)](profileNameId,_0x3f1d9a[_0x38d080(0x1fe)],_0x771932['date'],'',_0x38d080(0x205),_0x38d080(0x200)),_0x51f67f=_0x1e22b0['ID'],_0x59170c={'bot':_0x3f1d9a,'profileNameId':profileNameId,'genlogin':genlogin,'http':http,'dataId':_0x51f67f},_0x250953=await loadGameApi(_0x3f1d9a[_0x38d080(0x1fe)],_0x59170c);if(!_0x250953[_0x38d080(0x1e8)])return log('[xuLyGame]:\x20Thực\x20thi\x20'+_0x3f1d9a[_0x38d080(0x1fe)]+_0x38d080(0x23a),null,![]),await http[_0x38d080(0x1fc)](profileNameId,_0x51f67f,_0x38d080(0x248),_0x38d080(0x248)),null;if(_0x250953[_0x38d080(0x1e8)]==_0x38d080(0x236))return log(_0x38d080(0x22d)+_0x3f1d9a[_0x38d080(0x1fe)]+_0x38d080(0x1ff),null,'i'),'loop';if(_0x250953[_0x38d080(0x1e8)])return log('[xuLyGame]:\x20Thực\x20thi\x20'+_0x3f1d9a[_0x38d080(0x1fe)]+'\x20done'),await http[_0x38d080(0x239)](profileNameId,_0x3f1d9a['id'],_0x250953['nextRun'],_0x250953['nextRunStamp']),await http[_0x38d080(0x1fc)](profileNameId,_0x51f67f,'Ok',_0x38d080(0x212),_0x250953[_0x38d080(0x247)],_0x250953[_0x38d080(0x1e7)]),!![];}else{log(_0x38d080(0x20a)+_0x3f1d9a['name']+_0x38d080(0x235),null,'i');const _0x3dd253=await http['getAks'](_0x39018e);if(_0x3dd253){log(_0x38d080(0x1f0));let _0x2b9556=0x0;while(_0x2b9556<0x2){if(signal[_0x38d080(0x1d7)]){log(_0x38d080(0x22c),null,'w');throw new Error('timeout');}const _0x53076c=await checkTeleWebOpen(_0x3f1d9a,_0x3dd253);if(_0x53076c===_0x38d080(0x236))_0x2b9556++,log(_0x38d080(0x1da)+_0x2b9556+'/2',null,'i'),await delay(0x3e8);else return _0x53076c?(log(_0x38d080(0x1ed)),!![]):(log(_0x38d080(0x1fa),null,![]),null);}return log('[xuLyGame]:Max\x20loop\x20rồi\x20bro',null,![]),null;}}}catch(_0x1a3d7f){return log(_0x38d080(0x1e0)+_0x1a3d7f,null,![]),null;}}async function checkTeleWebOpen(_0x377921,_0x2cc243){const _0x573cad=a31_0x477724;try{if(signal[_0x573cad(0x1d7)]){log(_0x573cad(0x1dd),null,'w');throw new Error(_0x573cad(0x21d));}let _0x84a0d2=await genlogin[_0x573cad(0x211)](browser,0x0);const _0x572c0e=await genlogin[_0x573cad(0x1f8)](_0x84a0d2,_0x2cc243[_0x573cad(0x22b)],0x7d0);!_0x572c0e&&(await genlogin[_0x573cad(0x218)](_0x84a0d2,'https://www.google.com'),await delay(0x7d0),await genlogin[_0x573cad(0x218)](_0x84a0d2,_0x2cc243['FistUrl']),await delay(0x7d0));log(_0x573cad(0x1f2),null,'i');const _0x25b14b=await genlogin[_0x573cad(0x204)](),_0x10d0ad=await http[_0x573cad(0x22e)](profileNameId,_0x377921[_0x573cad(0x1fe)],_0x25b14b[_0x573cad(0x245)],'','Start',_0x573cad(0x200));dataId=_0x10d0ad['ID'];const _0x21d81f={'firstPage':_0x84a0d2,'bot':_0x377921,'profileNameId':profileNameId,'getAks':_0x2cc243,'genlogin':genlogin,'http':http,'browser':browser,'dataId':dataId};log(_0x573cad(0x244)+json(dataId),null,'i');if(timGame){await http[_0x573cad(0x1fc)](profileNameId,dataId,_0x573cad(0x206));const _0x3fa343=await loadGame(_0x573cad(0x230),_0x21d81f);if(_0x3fa343[_0x573cad(0x1e8)]=='loop')return log(_0x573cad(0x228)+_0x377921[_0x573cad(0x1fe)]+'\x20loop',null,'i'),await http[_0x573cad(0x1fc)](profileNameId,dataId,_0x573cad(0x23e)),'loop';else{if(!_0x3fa343)return log(_0x573cad(0x203)+_0x377921['name'],null,![]),null;}}await http[_0x573cad(0x1fc)](profileNameId,dataId,_0x573cad(0x246));const _0x5471fa=await loadGame(_0x377921[_0x573cad(0x1fe)],_0x21d81f);if(!_0x5471fa[_0x573cad(0x1e8)])return log(_0x573cad(0x227)+_0x377921['name'],null,![]),log(_0x573cad(0x1e4)+json(_0x5471fa),null,![]),null;else{if(_0x5471fa[_0x573cad(0x1e8)]=='loop')return log(_0x573cad(0x228)+_0x377921['name']+'\x20loop',null,'i'),await http[_0x573cad(0x1fc)](profileNameId,dataId,_0x573cad(0x236)),'loop';}return await http['nextRunTime'](profileNameId,_0x377921['id'],_0x5471fa[_0x573cad(0x1e7)],_0x5471fa['nextRunStamp']),await http[_0x573cad(0x1fc)](profileNameId,dataId,'Ok',_0x573cad(0x212),_0x5471fa[_0x573cad(0x247)],_0x5471fa['nextRun']),log(_0x573cad(0x202)+_0x377921[_0x573cad(0x1fe)]+'\x20thành\x20công'),await delay(0x7d0),!![];}catch(_0x5deb4d){return log(_0x573cad(0x23b)+_0x5deb4d,null,![]),null;}}async function loadGame(_0x50ca71,_0x2d0574){const _0x2ae7df=a31_0x477724;try{if(signal[_0x2ae7df(0x1d7)]){log(_0x2ae7df(0x237),null,'w');throw new Error(_0x2ae7df(0x21d));}const _0x4af4d2=path[_0x2ae7df(0x234)](__dirname,'scripts',_0x50ca71+_0x2ae7df(0x20f)),_0x15e3d2=require(_0x4af4d2);if(typeof _0x15e3d2===_0x2ae7df(0x1f6)){const _0x15bf5f=await _0x15e3d2(_0x2d0574,signal);await delay(0x3e8);if(!_0x15bf5f[_0x2ae7df(0x1e8)])return log(_0x2ae7df(0x222)+_0x50ca71+_0x2ae7df(0x23f),null,![]),null;return _0x15bf5f['status']===_0x2ae7df(0x236)?(log(_0x2ae7df(0x219)+_0x50ca71+'\x20loop',null,'i'),_0x15bf5f):(log(_0x2ae7df(0x219)+_0x50ca71+'\x20'+_0x15bf5f[_0x2ae7df(0x1e8)],null,'i'),_0x15bf5f);}else return await delay(0x3e8),log(_0x2ae7df(0x222)+_0x50ca71+'\x20không\x20phải\x20là\x20một\x20hàm\x20hợp\x20lệ',null,![]),null;}catch(_0x32e9e1){return log(_0x2ae7df(0x1fd)+_0x50ca71+':\x20'+_0x32e9e1,null,![]),null;}}function a31_0x4b6e(){const _0x4afff2=['function','\x20thành\x20công','elementExistsByXPath','\x20Tele\x20K\x20OK','[xuLyGame]:\x20checkTeleWebOpen\x20có\x20gì\x20đó\x20sai\x20sai\x20rồi\x20bro','onOff','updateData','[loadGame]:\x20Lỗi\x20khi\x20load\x20và\x20thực\x20thi\x20script\x20','name','\x20loop','running','[xuLyProfile]:\x20Processing\x20profile:\x20','[checkTeleWebOpen]:\x20Thực\x20thi\x20script\x20','[checkTeleWebOpen]:\x20Không\x20tìm\x20thấy\x20game\x20','nowTime','StartApi','Tìm','748610duKSdw','APIKEY','aks','[xuLyGame]:\x20','end','type','\x20Web\x20OK','path','.js','worker_threads','activateTab','Done','timestamp','[xuLyProfile]:\x20Profile\x20đã\x20chạy\x20thành\x20công\x20với\x20wsEndpoint:','\x20Tele\x20A\x20OK','[worker-api3]:timeout','[xuLyProfile]:\x20Xử\x20lý\x20browser\x20','openUrl','[loadGame]:\x20Chạy\x20','message','stack','32IYvGeB','timeout','2887830AmgvDv','[xuLyProfile]:\x20Lỗi\x20chung\x20xuLyProfile:\x20','\x20ko\x20có\x20aks','p-queue','[loadGame]:\x20Script\x20','default','\x20để\x20kiểm\x20tra\x20wsEndpoint...','1307784APAlhG','24047541HIYKus','[checkTeleWebOpen]:\x20Không\x20thực\x20thi\x20script\x20','[checkTeleWebOpen]:\x20Thực\x20thi\x20','Lỗi\x20xử\x20lý\x20profile:\x20','./modules/logger','InputSearch','[xuLyGame]:đã\x20bị\x20hủy','[xuLyGame]:\x20Thực\x20thi\x20','addData',']:\x20Bot\x20','timGame','split','1521744EEsbie','[xuLyBrowser]:\x20Lỗi\x20trong\x20quá\x20trình\x20xử\x20lý\x20browser:\x20','join','\x20Script\x20mode','loop','[loadGame]:đã\x20bị\x20hủy','[xuLyBrowser]:\x20','nextRunTime','\x20lỗi','[checkTeleWebOpen]:\x20Lỗi\x20trong\x20quá\x20trình\x20mở\x20trang\x20:\x20','3479700vPaPTY','No\x20bot\x20found','loop\x20new\x20game','\x20không\x20trả\x20về\x20status','[xuLyProfile]:\x20Thử\x20lần\x20','[xuLyProfile]:\x20Đang\x20mở\x20trình\x20duyệt...','postMessage','SERVER_HOST','[checkTeleWebOpen]:\x20dataId:\x20','date','Vào','coin','Fail','\x20OFF','[xuLyProfile]:\x20Xử\x20lý\x20profile\x20','aborted','[xuLyProfile]:đã\x20bị\x20hủy','[xuLyProfile]:\x20Đang\x20mở\x20profile\x20','[xuLyGame]:\x20Loop\x20lại\x20,\x20loop\x20lại\x20lần\x20','\x20is\x20not\x20running','\x20có\x20lỗi','[checkTeleWebOpen]:đã\x20bị\x20hủy','runProfile','[xuLyBrowser]:\x20Bot\x20OK','[xuLyGame]:\x20Lỗi\x20trong\x20quá\x20trình\x20xử\x20lý\x20Game:\x20','\x20Api\x20mode','\x20thất\x20bại','stringify','[checkTeleWebOpen]:\x20',']:\x20Api\x20Mode','13236391lpyDMO','nextRun','status','[xuLyProfile]:\x20Không\x20thể\x20lấy\x20được\x20wsEndpoint\x20sau\x205\x20lần\x20thử','checkProfileIsRun','config','[xuLyBrowser]:đã\x20bị\x20hủy','[xuLyGame]:\x20checkTeleWebOpen\x20OK',']:\x20Sai\x20aks\x20',']:\x20','[xuLyGame]:\x20getAks\x20OK','nextRunStamp','[checkTeleWebOpen]:\x20vào\x20loadGame','16ZLqBXg','[xuLyProfile]:\x20wsEndpoint:\x20','env'];a31_0x4b6e=function(){return _0x4afff2;};return a31_0x4b6e();}async function delay(_0x272cd8){return new Promise(_0x3f649c=>{const _0x3d5ae5=a31_0x2694;if(signal[_0x3d5ae5(0x1d7)])throw new Error(_0x3d5ae5(0x21d));setTimeout(_0x3f649c,_0x272cd8);});}