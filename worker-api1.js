const a29_0x46c20c=a29_0x387b;(function(_0x1f5013,_0x125591){const _0x13b993=a29_0x387b,_0x4df68c=_0x1f5013();while(!![]){try{const _0x547345=-parseInt(_0x13b993(0x110))/0x1+parseInt(_0x13b993(0x112))/0x2+-parseInt(_0x13b993(0x102))/0x3+-parseInt(_0x13b993(0xe8))/0x4+parseInt(_0x13b993(0xe0))/0x5*(-parseInt(_0x13b993(0xeb))/0x6)+parseInt(_0x13b993(0xde))/0x7+-parseInt(_0x13b993(0xf0))/0x8*(-parseInt(_0x13b993(0x10d))/0x9);if(_0x547345===_0x125591)break;else _0x4df68c['push'](_0x4df68c['shift']());}catch(_0x18519a){_0x4df68c['push'](_0x4df68c['shift']());}}}(a29_0x1840,0x35dd4),require('dotenv')[a29_0x46c20c(0x117)]());const {Worker,parentPort}=require(a29_0x46c20c(0x10f)),{AbortController}=require(a29_0x46c20c(0xe4)),{log,json}=require('./modules/logger'),Genlogin=require(a29_0x46c20c(0xf7)),httpPost=require('./modules/http'),PQueue=require(a29_0x46c20c(0xf8))[a29_0x46c20c(0xe6)];let profileQueue,genlogin,profileNameId,profileId,browser,http;function a29_0x1840(){const _0x3b47a9=['498584SipHNR','push','name','delayOpenProfile','error','[xuLyProfiles]:\x20Đã\x20xử\x20lý\x20tất\x20cả\x20profiles\x20thành\x20công','[xuLyTungProfile]3:\x20Lỗi\x20xử\x20lý\x20profile\x20','./modules/Genlogin','p-queue','getTask','[xuLyProfiles]:\x20Đã\x20thêm\x20profile\x20','length','\x20đã\x20thoát\x20với\x20mã\x20lỗi\x20','[xuLyTask]:\x20Chờ\x205\x20giây\x20trước\x20khi\x20xử\x20lý\x20task\x20tiếp\x20theo...','env','\x20vào\x20hàng\x20đợi\x20max:','[xuLyTask]:\x20Task\x20','[xuLyTungProfile]:\x20Lỗi:\x20','1237020xfYMcE','[\x27worker-api1]:\x20','[xuLyTungProfile]:\x20Đang\x20xử\x20lý\x20profile\x20','SERVER_HOST','\x20|\x20nextrun:\x20','all','nowTime','maxBotThreadsmaxBotThreadsmaxBotThreads','[xuLyTungProfile]:timeout','botTimeout','message','153GnmeFA','[\x27worker-api1][','worker_threads','251615fGXYKU','[xuLyProfiles]:đã\x20bị\x20hủy','397024AknYAK','nextrunstamp','[xuLyTask]:\x20Tasks:\x20','postMessage','profile\x20','config','[xuLyTungProfile]1:\x20Đã\x20xử\x20lý\x20profile\x20',']:\x20Api\x20Mode','value','APIKEY','\x20đã\x20bị\x20hủy','[xuLyProfiles]:\x20Lỗi\x20:\x20','nextrun','stringify','profiles','exit','./worker-api2.js','[xuLyTask]:\x20Không\x20lấy\x20được\x20dữ\x20liệu\x20profiles\x20','No\x20profile\x20found','2913834nuIHCM','aborted','25HaHXbQ','\x20set\x20timeout:\x20','botThreads','[xuLyTask]:\x20Lỗi\x20while:\x20','abort-controller','timeout','default','\x20vào\x20hàng\x20đợi.','1700088UvOHFK','[xuLyTask]:\x20currentDateTime:\x20','[xuLyProfiles]:\x20Thêm\x20profile\x20','437592fRMhus','[xuLyProfiles]:\x20Task\x20','[xuLyTungProfile]:profile\x20','\x20timed\x20out.','date'];a29_0x1840=function(){return _0x3b47a9;};return a29_0x1840();}genlogin=new Genlogin('',!![]),http=new httpPost(process[a29_0x46c20c(0xfe)][a29_0x46c20c(0x105)],process[a29_0x46c20c(0xfe)][a29_0x46c20c(0x11b)],!![]);let signal={'aborted':![]},firstRun=!![],delayOpenProfile=0xbb8,profileTimeout=0x5265c0,botTimeout=0x5265c0,profileThreads=0x1,maxBotThreads=0x1;parentPort['on'](a29_0x46c20c(0x10c),async _0x5bc67b=>{const _0x1110cb=a29_0x46c20c;try{if(_0x5bc67b===_0x1110cb(0xe5))signal[_0x1110cb(0xdf)]=!![];else{const {task:_0x1b0150}=_0x5bc67b;log(_0x1110cb(0x10e)+_0x1b0150[_0x1110cb(0xf2)]+_0x1110cb(0x119),null,'w');if(signal[_0x1110cb(0xdf)])throw new Error(_0x1110cb(0xe5));const _0x410177=await xuLyTask(_0x1b0150);log(_0x1110cb(0x103)+json(_0x410177),null,'w'),!_0x410177?parentPort[_0x1110cb(0x115)]({'success':![],'result':_0x410177}):parentPort[_0x1110cb(0x115)]({'success':!![],'result':_0x410177});}}catch(_0x4c5d63){parentPort[_0x1110cb(0x115)]({'success':![],'error':_0x4c5d63[_0x1110cb(0x10c)]});}});async function xuLyTask(_0x111601){const _0x4f6ec8=a29_0x46c20c;try{if(signal['aborted']){log(_0x4f6ec8(0x100)+_0x111601[_0x4f6ec8(0xf2)]+'\x20đã\x20bị\x20hủy\x20trước\x20khi\x20bắt\x20đầu',null,'w');throw new Error(_0x4f6ec8(0xe5));}const _0x361228=await genlogin[_0x4f6ec8(0x108)](),_0x1f4e75=_0x361228[_0x4f6ec8(0xef)];if(_0x1f4e75<_0x111601[_0x4f6ec8(0x113)])return log(_0x4f6ec8(0x100)+JSON[_0x4f6ec8(0xd8)](_0x111601[_0x4f6ec8(0xf2)])+'\x20chưa\x20đến\x20thời\x20gian\x20chạy',null,'i'),log(_0x4f6ec8(0xe9)+JSON[_0x4f6ec8(0xd8)](_0x361228)+_0x4f6ec8(0x106)+JSON['stringify'](_0x111601[_0x4f6ec8(0xd7)]),null,'w'),log('[xuLyTask]:\x20currentDateTime:\x20'+JSON[_0x4f6ec8(0xd8)](_0x1f4e75)+_0x4f6ec8(0x106)+JSON[_0x4f6ec8(0xd8)](taskNextRunDateTime),null,'w'),log(_0x4f6ec8(0xfd),null,'i'),await delay(0x1388),null;let _0x2c96fd=await http[_0x4f6ec8(0xf9)](_0x111601[_0x4f6ec8(0xf2)]);if(_0x2c96fd[_0x4f6ec8(0x11a)][_0x4f6ec8(0xd9)][_0x4f6ec8(0xfb)]<=0x0){log('[xuLyTask]:\x20không\x20lấy\x20được\x20profile',null,![]);throw new Error('No\x20profile\x20found');}firstRun&&(firstRun=![],profileThreads=parseInt(_0x111601['profileThreads']),maxBotThreads=parseInt(_0x111601[_0x4f6ec8(0xe2)]),profileQueue=new PQueue({'concurrency':profileThreads}),delayOpenProfile=parseInt(_0x111601[_0x4f6ec8(0xf3)])*0x3e8,profileTimeout=parseInt(_0x111601['profileTimeout'])*0x3e8,botTimeout=parseInt(_0x111601[_0x4f6ec8(0x10b)])*0x3e8);const _0x58fa50=await xuLyProfiles(_0x2c96fd[_0x4f6ec8(0x11a)][_0x4f6ec8(0xd9)]);if(!_0x58fa50){log(_0x4f6ec8(0xdc)+json(_0x58fa50),null,![]);throw new Error(_0x4f6ec8(0xdd));}return log(_0x4f6ec8(0x114)+_0x111601[_0x4f6ec8(0xf2)]+'\x20ok'),await delay(0x7d0),log('[xuLyTask]:\x20Hoàn\x20thành\x20xử\x20lý\x20task:\x20'+JSON[_0x4f6ec8(0xd8)](_0x111601[_0x4f6ec8(0xf2)])),!![];}catch(_0x31f91f){return log(_0x4f6ec8(0xe3)+_0x31f91f,null,![]),null;}}function a29_0x387b(_0x261deb,_0x12902d){const _0x184049=a29_0x1840();return a29_0x387b=function(_0x387b7d,_0x4683c6){_0x387b7d=_0x387b7d-0xd5;let _0x97f294=_0x184049[_0x387b7d];return _0x97f294;},a29_0x387b(_0x261deb,_0x12902d);}async function xuLyProfiles(_0x49cf26){const _0x97298d=a29_0x46c20c;try{if(signal[_0x97298d(0xdf)]){log(_0x97298d(0x111),null,'w');throw new Error(_0x97298d(0xe5));}const _0x53aa8e=[];for(const _0x293d2a of _0x49cf26){if(signal['aborted']){log(_0x97298d(0xec)+_0x293d2a+_0x97298d(0xd5),null,'w');throw new Error(_0x97298d(0xe5));}log(_0x97298d(0xea)+_0x293d2a+_0x97298d(0xff)+profileThreads,null,'i'),_0x53aa8e[_0x97298d(0xf1)](profileQueue['add'](()=>xuLyTungProfile(_0x293d2a))),log(_0x97298d(0xfa)+_0x293d2a+_0x97298d(0xe7)),await delay(delayOpenProfile);}return await Promise[_0x97298d(0x107)](_0x53aa8e),log(_0x97298d(0xf5)),!![];}catch(_0x434223){return log(_0x97298d(0xd6)+_0x434223,null,![]),null;}}async function xuLyTungProfile(_0x33e3be){const _0x4ee0e5=a29_0x46c20c;try{let _0x45b7c8={'aborted':![]};log(_0x4ee0e5(0x104)+_0x33e3be,null,'i');if(signal[_0x4ee0e5(0xdf)]){log('[xuLyTungProfile]:đã\x20bị\x20hủy',null,'w'),_0x45b7c8[_0x4ee0e5(0xdf)]=!![];throw new Error(_0x4ee0e5(0xe5));}return new Promise((_0x5b7838,_0x5dd884)=>{const _0x494eda=_0x4ee0e5,_0x48684d=new Worker(_0x494eda(0xdb)),_0x1524f8=setTimeout(()=>{const _0xe7c2fc=_0x494eda;_0x48684d[_0xe7c2fc(0x115)]({'profile':_0xe7c2fc(0xe5)}),_0x5dd884(new Error(_0xe7c2fc(0x116)+_0x33e3be+_0xe7c2fc(0xee)));},profileTimeout);log(_0x494eda(0xed)+_0x33e3be+_0x494eda(0xe1)+profileTimeout,null,'w');const _0xffaf7e=setInterval(()=>{const _0x55d674=_0x494eda;signal[_0x55d674(0xdf)]&&(log(_0x55d674(0x10a),null,'w'),_0x48684d[_0x55d674(0x115)]({'profile':'timeout'}));},0x1388);if(_0x45b7c8[_0x494eda(0xdf)]){_0x48684d[_0x494eda(0x115)]('timeout');throw new Error(_0x494eda(0xe5));}log(_0x494eda(0x109)+maxBotThreads),_0x48684d['postMessage']({'profile':_0x33e3be,'maxBot':maxBotThreads}),_0x48684d['on'](_0x494eda(0x10c),_0x56deba=>{const _0x253321=_0x494eda;clearTimeout(_0x1524f8),clearInterval(_0xffaf7e),_0x56deba['success']?(log(_0x253321(0x118)+_0x33e3be,null,'i'),_0x5b7838(!![])):(log('[xuLyTungProfile]2:\x20Lỗi\x20xử\x20lý\x20profile\x20'+_0x33e3be+':\x20'+json(_0x56deba['error']),null,![]),_0x5dd884(_0x56deba[_0x253321(0xf4)])),log('[xuLyTungProfile]:\x20Kết\x20thúc\x20worker\x20'+_0x33e3be,null,'w');}),_0x48684d['on'](_0x494eda(0xf4),_0x435c8e=>{const _0x1712d5=_0x494eda;clearInterval(_0xffaf7e),clearTimeout(_0x1524f8),log(_0x1712d5(0xf6)+_0x33e3be+':\x20'+json(_0x435c8e),null,![]),_0x5dd884(_0x435c8e);}),_0x48684d['on'](_0x494eda(0xda),_0x53f21b=>{const _0x3cf57e=_0x494eda;clearInterval(_0xffaf7e),_0x53f21b!==0x0&&(log('[xuLyTungProfile]4:\x20Worker\x20'+_0x33e3be+_0x3cf57e(0xfc)+_0x53f21b,null,![]),_0x5dd884(new Error('Worker\x20stopped\x20with\x20exit\x20code\x20'+_0x53f21b)));});});}catch(_0x2da003){clearInterval(intervalId),log(_0x4ee0e5(0x101)+_0x2da003[_0x4ee0e5(0x10c)],null,![]);throw _0x2da003;}}async function delay(_0x2c9b2f){return new Promise(_0x35109c=>{const _0x79761f=a29_0x387b;if(signal['aborted'])throw new Error(_0x79761f(0xe5));setTimeout(_0x35109c,_0x2c9b2f);});}