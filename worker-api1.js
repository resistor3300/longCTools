const a0_0x40cad=a0_0x2302;(function(_0x18fad4,_0x232b23){const _0x1a862e=a0_0x2302,_0x5428c7=_0x18fad4();while(!![]){try{const _0x2211c9=parseInt(_0x1a862e(0xd6))/0x1+-parseInt(_0x1a862e(0xde))/0x2*(-parseInt(_0x1a862e(0x10a))/0x3)+-parseInt(_0x1a862e(0x110))/0x4*(-parseInt(_0x1a862e(0xef))/0x5)+parseInt(_0x1a862e(0x104))/0x6+parseInt(_0x1a862e(0xfd))/0x7*(-parseInt(_0x1a862e(0x100))/0x8)+-parseInt(_0x1a862e(0xd4))/0x9*(parseInt(_0x1a862e(0xe6))/0xa)+parseInt(_0x1a862e(0xf2))/0xb;if(_0x2211c9===_0x232b23)break;else _0x5428c7['push'](_0x5428c7['shift']());}catch(_0x3fb71d){_0x5428c7['push'](_0x5428c7['shift']());}}}(a0_0x14f2,0xec6ba),require(a0_0x40cad(0xe0))[a0_0x40cad(0xdf)]());const {Worker,parentPort}=require('worker_threads'),{AbortController}=require('abort-controller'),{log,json}=require(a0_0x40cad(0x118)),Genlogin=require(a0_0x40cad(0xe1)),httpPost=require('./modules/http'),PQueue=require('p-queue')['default'];function a0_0x2302(_0x59074d,_0x1e0c31){const _0x14f2fa=a0_0x14f2();return a0_0x2302=function(_0x230296,_0x14647a){_0x230296=_0x230296-0xd4;let _0x418cc1=_0x14f2fa[_0x230296];return _0x418cc1;},a0_0x2302(_0x59074d,_0x1e0c31);}let profileQueue,genlogin,profileNameId,profileId,browser,http;genlogin=new Genlogin('',!![]),http=new httpPost(process[a0_0x40cad(0xf1)]['SERVER_HOST'],process[a0_0x40cad(0xf1)][a0_0x40cad(0xd5)],!![]);let signal={'aborted':![]},firstRun=!![],delayOpenProfile=0xbb8,profileTimeout=0x5265c0,botTimeout=0x5265c0,profileThreads=0x1,maxBotThreads=0x1;parentPort['on']('message',async _0x11d787=>{const _0x46685f=a0_0x40cad;try{if(_0x11d787===_0x46685f(0xed))signal[_0x46685f(0xec)]=!![];else{const {task:_0x4be409}=_0x11d787;log(_0x46685f(0xfc)+_0x4be409['name']+_0x46685f(0xe9),null,'w');if(signal[_0x46685f(0xec)])throw new Error('timeout');const _0x971afb=await xuLyTask(_0x4be409);log(_0x46685f(0xda)+json(_0x971afb),null,'w'),!_0x971afb?parentPort[_0x46685f(0xe3)]({'success':![],'result':_0x971afb}):parentPort[_0x46685f(0xe3)]({'success':!![],'result':_0x971afb});}}catch(_0x30e9c1){parentPort[_0x46685f(0xe3)]({'success':![],'error':_0x30e9c1[_0x46685f(0x107)]});}});async function xuLyTask(_0x39e318){const _0x378628=a0_0x40cad;try{if(signal[_0x378628(0xec)]){log(_0x378628(0x109)+_0x39e318[_0x378628(0x10e)]+_0x378628(0xe4),null,'w');throw new Error('timeout');}const _0x139421=await genlogin[_0x378628(0xf4)](),_0x1da96b=_0x139421[_0x378628(0x10c)];if(_0x1da96b<_0x39e318[_0x378628(0xf6)])return log(_0x378628(0x109)+JSON[_0x378628(0x105)](_0x39e318[_0x378628(0x10e)])+_0x378628(0x106),null,'i'),log('[xuLyTask]:\x20currentDateTime:\x20'+JSON[_0x378628(0x105)](_0x139421)+_0x378628(0x101)+JSON['stringify'](_0x39e318[_0x378628(0xf9)]),null,'w'),log(_0x378628(0xdb)+JSON[_0x378628(0x105)](_0x1da96b)+'\x20|\x20nextrun:\x20'+JSON[_0x378628(0x105)](taskNextRunDateTime),null,'w'),log(_0x378628(0xf0),null,'i'),await delay(0x1388),null;let _0x354f6a=await http['getTask'](_0x39e318['name']);if(_0x354f6a[_0x378628(0xea)][_0x378628(0xf7)]['length']<=0x0){log(_0x378628(0x10f),null,![]);throw new Error('No\x20profile\x20found');}firstRun&&(firstRun=![],profileThreads=parseInt(_0x39e318[_0x378628(0x115)]),maxBotThreads=parseInt(_0x39e318[_0x378628(0x108)]),profileQueue=new PQueue({'concurrency':profileThreads}),delayOpenProfile=parseInt(_0x39e318['delayOpenProfile'])*0x3e8,profileTimeout=parseInt(_0x39e318[_0x378628(0xf3)])*0x3e8,botTimeout=parseInt(_0x39e318[_0x378628(0xe2)])*0x3e8);const _0x5de819=await xuLyProfiles(_0x354f6a[_0x378628(0xea)][_0x378628(0xf7)]);if(!_0x5de819){log('[xuLyTask]:\x20Không\x20lấy\x20được\x20dữ\x20liệu\x20profiles\x20'+json(_0x5de819),null,![]);throw new Error(_0x378628(0x11a));}return log(_0x378628(0x116)+_0x39e318['name']+_0x378628(0x113)),await delay(0x7d0),log(_0x378628(0x10d)+JSON['stringify'](_0x39e318[_0x378628(0x10e)])),!![];}catch(_0x219f32){return log(_0x378628(0xfa)+_0x219f32,null,![]),null;}}async function xuLyProfiles(_0x519d73){const _0x5373a5=a0_0x40cad;try{if(signal['aborted']){log(_0x5373a5(0xd9),null,'w');throw new Error('timeout');}const _0x5c377e=[];for(const _0xab1c89 of _0x519d73){if(signal['aborted']){log(_0x5373a5(0xee)+_0xab1c89+'\x20đã\x20bị\x20hủy',null,'w');throw new Error('timeout');}log(_0x5373a5(0x119)+_0xab1c89+_0x5373a5(0xe8)+profileThreads,null,'i'),_0x5c377e[_0x5373a5(0x117)](profileQueue[_0x5373a5(0xe5)](()=>xuLyTungProfile(_0xab1c89))),log('[xuLyProfiles]:\x20Đã\x20thêm\x20profile\x20'+_0xab1c89+_0x5373a5(0x112)),await delay(delayOpenProfile);}return await Promise[_0x5373a5(0xdc)](_0x5c377e),log(_0x5373a5(0x114)),!![];}catch(_0xb8cca3){return log(_0x5373a5(0xf5)+_0xb8cca3,null,![]),null;}}async function xuLyTungProfile(_0x51a365){const _0x190e3d=a0_0x40cad;try{let _0xfdd982={'aborted':![]};log(_0x190e3d(0xf8)+_0x51a365,null,'i');if(signal[_0x190e3d(0xec)]){log('[xuLyTungProfile]:đã\x20bị\x20hủy',null,'w'),_0xfdd982[_0x190e3d(0xec)]=!![];throw new Error(_0x190e3d(0xed));}return new Promise((_0x294cdb,_0x4b67c1)=>{const _0x951f8c=_0x190e3d,_0x381e6c=new Worker('./worker-api2.js'),_0x5b2177=setTimeout(()=>{const _0x1cdaf9=a0_0x2302;_0x381e6c[_0x1cdaf9(0xe3)]({'profile':_0x1cdaf9(0xed)}),_0x4b67c1(new Error('profile\x20'+_0x51a365+_0x1cdaf9(0xd8)));},profileTimeout);log(_0x951f8c(0xdd)+_0x51a365+_0x951f8c(0x10b)+profileTimeout,null,'w');const _0x57cb40=setInterval(()=>{const _0xc0628a=_0x951f8c;signal[_0xc0628a(0xec)]&&(log(_0xc0628a(0x111),null,'w'),_0x381e6c[_0xc0628a(0xe3)]({'profile':_0xc0628a(0xed)}));},0x1388);if(_0xfdd982[_0x951f8c(0xec)]){_0x381e6c[_0x951f8c(0xe3)](_0x951f8c(0xed));throw new Error(_0x951f8c(0xed));}log('maxBotThreadsmaxBotThreadsmaxBotThreads'+maxBotThreads),_0x381e6c[_0x951f8c(0xe3)]({'profile':_0x51a365,'maxBot':maxBotThreads}),_0x381e6c['on'](_0x951f8c(0x107),_0x210283=>{const _0x5f35c7=_0x951f8c;clearTimeout(_0x5b2177),clearInterval(_0x57cb40),_0x210283['success']?(log(_0x5f35c7(0xff)+_0x51a365,null,'i'),_0x294cdb(!![])):(log('[xuLyTungProfile]2:\x20Lỗi\x20xử\x20lý\x20profile\x20'+_0x51a365+':\x20'+json(_0x210283[_0x5f35c7(0xfb)]),null,![]),_0x4b67c1(_0x210283[_0x5f35c7(0xfb)])),log(_0x5f35c7(0xd7)+_0x51a365,null,'w');}),_0x381e6c['on'](_0x951f8c(0xfb),_0x426d42=>{const _0x30af25=_0x951f8c;clearInterval(_0x57cb40),clearTimeout(_0x5b2177),log(_0x30af25(0xe7)+_0x51a365+':\x20'+json(_0x426d42),null,![]),_0x4b67c1(_0x426d42);}),_0x381e6c['on'](_0x951f8c(0x103),_0x2f9e7a=>{const _0x5c8cea=_0x951f8c;clearInterval(_0x57cb40),_0x2f9e7a!==0x0&&(log(_0x5c8cea(0x102)+_0x51a365+_0x5c8cea(0xeb)+_0x2f9e7a,null,![]),_0x4b67c1(new Error(_0x5c8cea(0x11b)+_0x2f9e7a)));});});}catch(_0x41db3c){clearInterval(intervalId),log(_0x190e3d(0xfe)+_0x41db3c[_0x190e3d(0x107)],null,![]);throw _0x41db3c;}}async function delay(_0x46c0db){return new Promise(_0x993fa1=>{const _0x9e7045=a0_0x2302;if(signal[_0x9e7045(0xec)])throw new Error(_0x9e7045(0xed));setTimeout(_0x993fa1,_0x46c0db);});}function a0_0x14f2(){const _0x29a9dc=['value','\x20đã\x20thoát\x20với\x20mã\x20lỗi\x20','aborted','timeout','[xuLyProfiles]:\x20Task\x20','1285tnhkXH','[xuLyTask]:\x20Chờ\x205\x20giây\x20trước\x20khi\x20xử\x20lý\x20task\x20tiếp\x20theo...','env','20977990ATPjPS','profileTimeout','nowTime','[xuLyProfiles]:\x20Lỗi\x20:\x20','nextrunstamp','profiles','[xuLyTungProfile]:\x20Đang\x20xử\x20lý\x20profile\x20','nextrun','[xuLyTask]:\x20Lỗi\x20while:\x20','error','[\x27worker-api1][','7ZZopaS','[xuLyTungProfile]:\x20Lỗi:\x20','[xuLyTungProfile]1:\x20Đã\x20xử\x20lý\x20profile\x20','8348696vsQLGq','\x20|\x20nextrun:\x20','[xuLyTungProfile]4:\x20Worker\x20','exit','1555176KwYolZ','stringify','\x20chưa\x20đến\x20thời\x20gian\x20chạy','message','botThreads','[xuLyTask]:\x20Task\x20','5181iQCYQY','\x20set\x20timeout:\x20','date','[xuLyTask]:\x20Hoàn\x20thành\x20xử\x20lý\x20task:\x20','name','[xuLyTask]:\x20không\x20lấy\x20được\x20profile','1636rEqDPr','[xuLyTungProfile]:timeout','\x20vào\x20hàng\x20đợi.','\x20ok','[xuLyProfiles]:\x20Đã\x20xử\x20lý\x20tất\x20cả\x20profiles\x20thành\x20công','profileThreads','[xuLyTask]:\x20Tasks:\x20','push','./modules/logger','[xuLyProfiles]:\x20Thêm\x20profile\x20','No\x20profile\x20found','Worker\x20stopped\x20with\x20exit\x20code\x20','6364683AlDYDv','APIKEY','379517BtdcBe','[xuLyTungProfile]:\x20Kết\x20thúc\x20worker\x20','\x20timed\x20out.','[xuLyProfiles]:đã\x20bị\x20hủy','[\x27worker-api1]:\x20','[xuLyTask]:\x20currentDateTime:\x20','all','[xuLyTungProfile]:profile\x20','898BORyBG','config','dotenv','./modules/Genlogin','botTimeout','postMessage','\x20đã\x20bị\x20hủy\x20trước\x20khi\x20bắt\x20đầu','add','20qCorRY','[xuLyTungProfile]3:\x20Lỗi\x20xử\x20lý\x20profile\x20','\x20vào\x20hàng\x20đợi\x20max:',']:\x20Api\x20Mode'];a0_0x14f2=function(){return _0x29a9dc;};return a0_0x14f2();}