const a29_0xc141b9=a29_0x5f07;(function(_0x3d7d55,_0x4294df){const _0x3bb507=a29_0x5f07,_0x5a6314=_0x3d7d55();while(!![]){try{const _0x215cb6=-parseInt(_0x3bb507(0x100))/0x1+-parseInt(_0x3bb507(0xd8))/0x2*(-parseInt(_0x3bb507(0xea))/0x3)+-parseInt(_0x3bb507(0xf5))/0x4*(parseInt(_0x3bb507(0xcc))/0x5)+-parseInt(_0x3bb507(0xd9))/0x6+parseInt(_0x3bb507(0xcb))/0x7+parseInt(_0x3bb507(0xdd))/0x8*(parseInt(_0x3bb507(0xf8))/0x9)+parseInt(_0x3bb507(0xe8))/0xa*(-parseInt(_0x3bb507(0xc7))/0xb);if(_0x215cb6===_0x4294df)break;else _0x5a6314['push'](_0x5a6314['shift']());}catch(_0x341ddc){_0x5a6314['push'](_0x5a6314['shift']());}}}(a29_0x384a,0x950fc),require('dotenv')['config']());function a29_0x5f07(_0x4929cb,_0x23bbad){const _0x384a86=a29_0x384a();return a29_0x5f07=function(_0x5f079f,_0x53d3bb){_0x5f079f=_0x5f079f-0xc2;let _0x2ee74d=_0x384a86[_0x5f079f];return _0x2ee74d;},a29_0x5f07(_0x4929cb,_0x23bbad);}function a29_0x384a(){const _0x37a667=['postMessage','[xuLyTungProfile]3:\x20Lỗi\x20xử\x20lý\x20profile\x20','46416zItGhs','[xuLyProfiles]:\x20Lỗi\x20:\x20','getTask','[xuLyTungProfile]:profile\x20','[xuLyTask]:\x20không\x20lấy\x20được\x20profile','No\x20profile\x20found','[xuLyTungProfile]:đã\x20bị\x20hủy','nextrun','33TmBSZQ','\x20đã\x20bị\x20hủy\x20trước\x20khi\x20bắt\x20đầu','Worker\x20stopped\x20with\x20exit\x20code\x20','botTimeout','6017592qEGERf','245AyyPgS','\x20set\x20timeout:\x20','[xuLyTungProfile]4:\x20Worker\x20','date','[\x27worker-api1]:\x20','push','\x20|\x20nextrun:\x20','[xuLyTask]:\x20Lỗi\x20while:\x20','./modules/http','message','[xuLyTask]:\x20Không\x20lấy\x20được\x20dữ\x20liệu\x20profiles\x20','all','12vrhcvR','3014838lOAhjX','[xuLyTungProfile]2:\x20Lỗi\x20xử\x20lý\x20profile\x20','[xuLyTask]:\x20Tasks:\x20','\x20đã\x20thoát\x20với\x20mã\x20lỗi\x20','1754936QKxTkw','nextrunstamp','stringify','delayOpenProfile','[xuLyProfiles]:đã\x20bị\x20hủy','env','[xuLyProfiles]:\x20Đã\x20xử\x20lý\x20tất\x20cả\x20profiles\x20thành\x20công','default','profiles','[xuLyTask]:\x20Task\x20','botThreads','76690OVTQSX','p-queue','413463eSvtQj','success','[xuLyTungProfile]:\x20Kết\x20thúc\x20worker\x20','nowTime','\x20đã\x20bị\x20hủy','timeout','error','[xuLyProfiles]:\x20Thêm\x20profile\x20','[xuLyTask]:\x20Hoàn\x20thành\x20xử\x20lý\x20task:\x20','aborted','profile\x20','94876YcNsPD','[xuLyProfiles]:\x20Đã\x20thêm\x20profile\x20','\x20chưa\x20đến\x20thời\x20gian\x20chạy','27YUsSEH','[xuLyTask]:\x20Chờ\x205\x20giây\x20trước\x20khi\x20xử\x20lý\x20task\x20tiếp\x20theo...','add','name','exit','[xuLyTask]:\x20currentDateTime:\x20'];a29_0x384a=function(){return _0x37a667;};return a29_0x384a();}const {Worker,parentPort}=require('worker_threads'),{AbortController}=require('abort-controller'),{log,json}=require('./modules/logger'),Genlogin=require('./modules/Genlogin'),httpPost=require(a29_0xc141b9(0xd4)),PQueue=require(a29_0xc141b9(0xe9))[a29_0xc141b9(0xe4)];let profileQueue,genlogin,profileNameId,profileId,browser,http;genlogin=new Genlogin('',!![]),http=new httpPost(process[a29_0xc141b9(0xe2)]['SERVER_HOST'],process[a29_0xc141b9(0xe2)]['APIKEY'],!![]);let signal={'aborted':![]},firstRun=!![],delayOpenProfile=0xbb8,profileTimeout=0x5265c0,botTimeout=0x5265c0,profileThreads=0x1,maxBotThreads=0x1;parentPort['on'](a29_0xc141b9(0xd5),async _0x49b569=>{const _0x49d5ab=a29_0xc141b9;try{if(_0x49b569===_0x49d5ab(0xef))signal['aborted']=!![];else{const {task:_0x501ab2}=_0x49b569;log('[\x27worker-api1]['+_0x501ab2[_0x49d5ab(0xfb)]+']:\x20Api\x20Mode',null,'w');if(signal['aborted'])throw new Error('timeout');const _0x53b544=await xuLyTask(_0x501ab2);log(_0x49d5ab(0xd0)+json(_0x53b544),null,'w'),!_0x53b544?parentPort[_0x49d5ab(0xfe)]({'success':![],'result':_0x53b544}):parentPort[_0x49d5ab(0xfe)]({'success':!![],'result':_0x53b544});}}catch(_0x4e3ff1){parentPort['postMessage']({'success':![],'error':_0x4e3ff1[_0x49d5ab(0xd5)]});}});async function xuLyTask(_0x2c4742){const _0x2ca53f=a29_0xc141b9;try{if(signal['aborted']){log(_0x2ca53f(0xe6)+_0x2c4742['name']+_0x2ca53f(0xc8),null,'w');throw new Error(_0x2ca53f(0xef));}const _0x2737e9=await genlogin[_0x2ca53f(0xed)](),_0x209fec=_0x2737e9[_0x2ca53f(0xcf)];if(_0x209fec<_0x2c4742[_0x2ca53f(0xde)])return log(_0x2ca53f(0xe6)+JSON['stringify'](_0x2c4742['name'])+_0x2ca53f(0xf7),null,'i'),log(_0x2ca53f(0xfd)+JSON[_0x2ca53f(0xdf)](_0x2737e9)+_0x2ca53f(0xd2)+JSON[_0x2ca53f(0xdf)](_0x2c4742[_0x2ca53f(0xc6)]),null,'w'),log(_0x2ca53f(0xfd)+JSON[_0x2ca53f(0xdf)](_0x209fec)+_0x2ca53f(0xd2)+JSON[_0x2ca53f(0xdf)](taskNextRunDateTime),null,'w'),log(_0x2ca53f(0xf9),null,'i'),await delay(0x1388),null;let _0x57c391=await http[_0x2ca53f(0x102)](_0x2c4742['name']);if(_0x57c391['value'][_0x2ca53f(0xe5)]['length']<=0x0){log(_0x2ca53f(0xc3),null,![]);throw new Error('No\x20profile\x20found');}firstRun&&(firstRun=![],profileThreads=parseInt(_0x2c4742['profileThreads']),maxBotThreads=parseInt(_0x2c4742[_0x2ca53f(0xe7)]),profileQueue=new PQueue({'concurrency':profileThreads}),delayOpenProfile=parseInt(_0x2c4742[_0x2ca53f(0xe0)])*0x3e8,profileTimeout=parseInt(_0x2c4742['profileTimeout'])*0x3e8,botTimeout=parseInt(_0x2c4742[_0x2ca53f(0xca)])*0x3e8);const _0x2d6368=await xuLyProfiles(_0x57c391['value'][_0x2ca53f(0xe5)]);if(!_0x2d6368){log(_0x2ca53f(0xd6)+json(_0x2d6368),null,![]);throw new Error(_0x2ca53f(0xc4));}return log(_0x2ca53f(0xdb)+_0x2c4742[_0x2ca53f(0xfb)]+'\x20ok'),await delay(0x7d0),log(_0x2ca53f(0xf2)+JSON['stringify'](_0x2c4742[_0x2ca53f(0xfb)])),!![];}catch(_0x439c6a){return log(_0x2ca53f(0xd3)+_0x439c6a,null,![]),null;}}async function xuLyProfiles(_0x173450){const _0x1f3256=a29_0xc141b9;try{if(signal[_0x1f3256(0xf3)]){log(_0x1f3256(0xe1),null,'w');throw new Error(_0x1f3256(0xef));}const _0x3bbb83=[];for(const _0x494d44 of _0x173450){if(signal[_0x1f3256(0xf3)]){log('[xuLyProfiles]:\x20Task\x20'+_0x494d44+_0x1f3256(0xee),null,'w');throw new Error(_0x1f3256(0xef));}log(_0x1f3256(0xf1)+_0x494d44+'\x20vào\x20hàng\x20đợi\x20max:'+profileThreads,null,'i'),_0x3bbb83[_0x1f3256(0xd1)](profileQueue[_0x1f3256(0xfa)](()=>xuLyTungProfile(_0x494d44))),log(_0x1f3256(0xf6)+_0x494d44+'\x20vào\x20hàng\x20đợi.'),await delay(delayOpenProfile);}return await Promise[_0x1f3256(0xd7)](_0x3bbb83),log(_0x1f3256(0xe3)),!![];}catch(_0x30bf42){return log(_0x1f3256(0x101)+_0x30bf42,null,![]),null;}}async function xuLyTungProfile(_0x517743){const _0x49966d=a29_0xc141b9;try{let _0x2c2270={'aborted':![]};log('[xuLyTungProfile]:\x20Đang\x20xử\x20lý\x20profile\x20'+_0x517743,null,'i');if(signal[_0x49966d(0xf3)]){log(_0x49966d(0xc5),null,'w'),_0x2c2270['aborted']=!![];throw new Error('timeout');}return new Promise((_0x59069f,_0xa0bcd7)=>{const _0x50a5e1=_0x49966d,_0x1a56a5=new Worker('./worker-api2.js'),_0x16330b=setTimeout(()=>{const _0x190405=a29_0x5f07;_0x1a56a5[_0x190405(0xfe)]({'profile':_0x190405(0xef)}),_0xa0bcd7(new Error(_0x190405(0xf4)+_0x517743+'\x20timed\x20out.'));},profileTimeout);log(_0x50a5e1(0xc2)+_0x517743+_0x50a5e1(0xcd)+profileTimeout,null,'w');const _0x9406b1=setInterval(()=>{const _0x279163=_0x50a5e1;signal[_0x279163(0xf3)]&&(log('[xuLyTungProfile]:timeout',null,'w'),_0x1a56a5['postMessage']({'profile':_0x279163(0xef)}));},0x1388);if(_0x2c2270['aborted']){_0x1a56a5[_0x50a5e1(0xfe)](_0x50a5e1(0xef));throw new Error(_0x50a5e1(0xef));}log('maxBotThreadsmaxBotThreadsmaxBotThreads'+maxBotThreads),_0x1a56a5[_0x50a5e1(0xfe)]({'profile':_0x517743,'maxBot':maxBotThreads}),_0x1a56a5['on']('message',_0x26f0fa=>{const _0x47050d=_0x50a5e1;clearTimeout(_0x16330b),clearInterval(_0x9406b1),_0x26f0fa[_0x47050d(0xeb)]?(log('[xuLyTungProfile]1:\x20Đã\x20xử\x20lý\x20profile\x20'+_0x517743,null,'i'),_0x59069f(!![])):(log(_0x47050d(0xda)+_0x517743+':\x20'+json(_0x26f0fa[_0x47050d(0xf0)]),null,![]),_0xa0bcd7(_0x26f0fa[_0x47050d(0xf0)])),log(_0x47050d(0xec)+_0x517743,null,'w');}),_0x1a56a5['on']('error',_0x264565=>{const _0x3b5bf4=_0x50a5e1;clearInterval(_0x9406b1),clearTimeout(_0x16330b),log(_0x3b5bf4(0xff)+_0x517743+':\x20'+json(_0x264565),null,![]),_0xa0bcd7(_0x264565);}),_0x1a56a5['on'](_0x50a5e1(0xfc),_0x5ce6e3=>{const _0x55b271=_0x50a5e1;clearInterval(_0x9406b1),_0x5ce6e3!==0x0&&(log(_0x55b271(0xce)+_0x517743+_0x55b271(0xdc)+_0x5ce6e3,null,![]),_0xa0bcd7(new Error(_0x55b271(0xc9)+_0x5ce6e3)));});});}catch(_0x3e60b2){clearInterval(intervalId),log('[xuLyTungProfile]:\x20Lỗi:\x20'+_0x3e60b2[_0x49966d(0xd5)],null,![]);throw _0x3e60b2;}}async function delay(_0x42ec47){return new Promise(_0x131cf0=>{const _0x539422=a29_0x5f07;if(signal['aborted'])throw new Error(_0x539422(0xef));setTimeout(_0x131cf0,_0x42ec47);});}