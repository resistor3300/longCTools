const a29_0x9e6b=a29_0x172f;(function(_0x1015b4,_0x3c990d){const _0xdc8ef=a29_0x172f,_0x257842=_0x1015b4();while(!![]){try{const _0x4c42fb=parseInt(_0xdc8ef(0x6b))/0x1*(parseInt(_0xdc8ef(0x7b))/0x2)+parseInt(_0xdc8ef(0x91))/0x3*(parseInt(_0xdc8ef(0x75))/0x4)+parseInt(_0xdc8ef(0xae))/0x5*(-parseInt(_0xdc8ef(0xad))/0x6)+-parseInt(_0xdc8ef(0x9b))/0x7*(-parseInt(_0xdc8ef(0xaa))/0x8)+parseInt(_0xdc8ef(0x94))/0x9*(parseInt(_0xdc8ef(0x8e))/0xa)+parseInt(_0xdc8ef(0xa1))/0xb*(-parseInt(_0xdc8ef(0x7c))/0xc)+-parseInt(_0xdc8ef(0x97))/0xd*(-parseInt(_0xdc8ef(0x72))/0xe);if(_0x4c42fb===_0x3c990d)break;else _0x257842['push'](_0x257842['shift']());}catch(_0x47daf8){_0x257842['push'](_0x257842['shift']());}}}(a29_0x2653,0x51e47),require('dotenv')[a29_0x9e6b(0x6e)]());const {Worker,parentPort}=require('worker_threads'),{AbortController}=require('abort-controller'),{log,json}=require(a29_0x9e6b(0x82)),Genlogin=require(a29_0x9e6b(0x6d)),httpPost=require(a29_0x9e6b(0x89)),PQueue=require('p-queue')[a29_0x9e6b(0x6c)];let profileQueue,genlogin,profileNameId,profileId,browser,http;genlogin=new Genlogin('',!![]),http=new httpPost(process[a29_0x9e6b(0x6a)][a29_0x9e6b(0x86)],process[a29_0x9e6b(0x6a)][a29_0x9e6b(0x83)],!![]);let signal={'aborted':![]},firstRun=!![],delayOpenProfile=0xbb8,profileTimeout=0x5265c0,botTimeout=0x5265c0,profileThreads=0x1,maxBotThreads=0x1;function a29_0x172f(_0x44d7ad,_0x160c77){const _0x265371=a29_0x2653();return a29_0x172f=function(_0x172fe1,_0x1aa3e9){_0x172fe1=_0x172fe1-0x69;let _0x1cc71c=_0x265371[_0x172fe1];return _0x1cc71c;},a29_0x172f(_0x44d7ad,_0x160c77);}parentPort['on'](a29_0x9e6b(0x6f),async _0x3405ab=>{const _0x7e5ac6=a29_0x9e6b;try{if(_0x3405ab===_0x7e5ac6(0x9d))signal['aborted']=!![];else{const {task:_0x551399}=_0x3405ab;log(_0x7e5ac6(0x88)+_0x551399[_0x7e5ac6(0x70)]+_0x7e5ac6(0x92),null,'w');if(signal[_0x7e5ac6(0xa7)])throw new Error(_0x7e5ac6(0x9d));const _0x2695b5=await xuLyTask(_0x551399);log(_0x7e5ac6(0x7a)+json(_0x2695b5),null,'w'),!_0x2695b5?parentPort[_0x7e5ac6(0x9a)]({'success':![],'result':_0x2695b5}):parentPort[_0x7e5ac6(0x9a)]({'success':!![],'result':_0x2695b5});}}catch(_0x2e80b8){parentPort['postMessage']({'success':![],'error':_0x2e80b8['message']});}});async function xuLyTask(_0x408f70){const _0x12d48b=a29_0x9e6b;try{if(signal[_0x12d48b(0xa7)]){log(_0x12d48b(0xaf)+_0x408f70[_0x12d48b(0x70)]+'\x20đã\x20bị\x20hủy\x20trước\x20khi\x20bắt\x20đầu',null,'w');throw new Error(_0x12d48b(0x9d));}const _0x57202f=await genlogin[_0x12d48b(0x99)](),_0x2e5a53=_0x57202f[_0x12d48b(0x80)];if(_0x2e5a53<_0x408f70[_0x12d48b(0x87)])return log(_0x12d48b(0xaf)+JSON[_0x12d48b(0xac)](_0x408f70[_0x12d48b(0x70)])+_0x12d48b(0x84),null,'i'),log(_0x12d48b(0x7e)+JSON['stringify'](_0x57202f)+_0x12d48b(0x69)+JSON['stringify'](_0x408f70['nextrun']),null,'w'),log('[xuLyTask]:\x20currentDateTime:\x20'+JSON['stringify'](_0x2e5a53)+_0x12d48b(0x69)+JSON['stringify'](taskNextRunDateTime),null,'w'),log('[xuLyTask]:\x20Chờ\x205\x20giây\x20trước\x20khi\x20xử\x20lý\x20task\x20tiếp\x20theo...',null,'i'),await delay(0x1388),null;let _0x2c7c1e=await http['getTask'](_0x408f70[_0x12d48b(0x70)]);if(_0x2c7c1e[_0x12d48b(0xa5)][_0x12d48b(0x93)][_0x12d48b(0xa4)]<=0x0){log(_0x12d48b(0x7f),null,![]);throw new Error(_0x12d48b(0x90));}firstRun&&(firstRun=![],profileThreads=parseInt(_0x408f70[_0x12d48b(0xa6)]),maxBotThreads=parseInt(_0x408f70[_0x12d48b(0x77)]),profileQueue=new PQueue({'concurrency':profileThreads}),delayOpenProfile=parseInt(_0x408f70[_0x12d48b(0x95)])*0x3e8,profileTimeout=parseInt(_0x408f70[_0x12d48b(0x7d)])*0x3e8,botTimeout=parseInt(_0x408f70[_0x12d48b(0x8c)])*0x3e8);const _0x586b66=await xuLyProfiles(_0x2c7c1e[_0x12d48b(0xa5)]['profiles']);if(!_0x586b66){log(_0x12d48b(0x79)+json(_0x586b66),null,![]);throw new Error(_0x12d48b(0x90));}return log(_0x12d48b(0x8d)+_0x408f70['name']+_0x12d48b(0x96)),await delay(0x7d0),log(_0x12d48b(0x8b)+JSON['stringify'](_0x408f70[_0x12d48b(0x70)])),!![];}catch(_0x3d9f94){return log('[xuLyTask]:\x20Lỗi\x20while:\x20'+_0x3d9f94,null,![]),null;}}async function xuLyProfiles(_0xbb703c){const _0x38a896=a29_0x9e6b;try{if(signal[_0x38a896(0xa7)]){log(_0x38a896(0x85),null,'w');throw new Error('timeout');}const _0x325774=[];for(const _0x56e4c0 of _0xbb703c){if(signal[_0x38a896(0xa7)]){log('[xuLyProfiles]:\x20Task\x20'+_0x56e4c0+_0x38a896(0x71),null,'w');throw new Error(_0x38a896(0x9d));}log('[xuLyProfiles]:\x20Thêm\x20profile\x20'+_0x56e4c0+'\x20vào\x20hàng\x20đợi\x20max:'+profileThreads,null,'i'),_0x325774['push'](profileQueue[_0x38a896(0x73)](()=>xuLyTungProfile(_0x56e4c0))),log('[xuLyProfiles]:\x20Đã\x20thêm\x20profile\x20'+_0x56e4c0+_0x38a896(0xa9)),await delay(delayOpenProfile);}return await Promise[_0x38a896(0x9e)](_0x325774),log('[xuLyProfiles]:\x20Đã\x20xử\x20lý\x20tất\x20cả\x20profiles\x20thành\x20công'),!![];}catch(_0x975798){return log('[xuLyProfiles]:\x20Lỗi\x20:\x20'+_0x975798,null,![]),null;}}function a29_0x2653(){const _0x3030c7=['postMessage','6209zDQzzY','[xuLyTungProfile]:\x20Lỗi:\x20','timeout','all','[xuLyTungProfile]:\x20Kết\x20thúc\x20worker\x20','\x20timed\x20out.','11PWlbQQ','./worker-api2.js','[xuLyTungProfile]3:\x20Lỗi\x20xử\x20lý\x20profile\x20','length','value','profileThreads','aborted','error','\x20vào\x20hàng\x20đợi.','104ehwdCE','[xuLyTungProfile]:đã\x20bị\x20hủy','stringify','444BYephK','29570LdzCmG','[xuLyTask]:\x20Task\x20','\x20|\x20nextrun:\x20','env','5125hqxbzD','default','./modules/Genlogin','config','message','name','\x20đã\x20bị\x20hủy','5630436SBlxUE','add','profile\x20','44dMpQCY','Worker\x20stopped\x20with\x20exit\x20code\x20','botThreads','\x20set\x20timeout:\x20','[xuLyTask]:\x20Không\x20lấy\x20được\x20dữ\x20liệu\x20profiles\x20','[\x27worker-api1]:\x20','34UsMjvN','7421952lFcQhT','profileTimeout','[xuLyTask]:\x20currentDateTime:\x20','[xuLyTask]:\x20không\x20lấy\x20được\x20profile','date','\x20đã\x20thoát\x20với\x20mã\x20lỗi\x20','./modules/logger','APIKEY','\x20chưa\x20đến\x20thời\x20gian\x20chạy','[xuLyProfiles]:đã\x20bị\x20hủy','SERVER_HOST','nextrunstamp','[\x27worker-api1][','./modules/http','[xuLyTungProfile]:timeout','[xuLyTask]:\x20Hoàn\x20thành\x20xử\x20lý\x20task:\x20','botTimeout','[xuLyTask]:\x20Tasks:\x20','420pEFgwY','[xuLyTungProfile]1:\x20Đã\x20xử\x20lý\x20profile\x20','No\x20profile\x20found','99315EaMOjB',']:\x20Api\x20Mode','profiles','26658TYibiT','delayOpenProfile','\x20ok','26xebqzq','[xuLyTungProfile]4:\x20Worker\x20','nowTime'];a29_0x2653=function(){return _0x3030c7;};return a29_0x2653();}async function xuLyTungProfile(_0x2d7f66){const _0x4342e4=a29_0x9e6b;try{let _0x44a41c={'aborted':![]};log('[xuLyTungProfile]:\x20Đang\x20xử\x20lý\x20profile\x20'+_0x2d7f66,null,'i');if(signal[_0x4342e4(0xa7)]){log(_0x4342e4(0xab),null,'w'),_0x44a41c['aborted']=!![];throw new Error(_0x4342e4(0x9d));}return new Promise((_0x5bf700,_0x2890f5)=>{const _0x3e867f=_0x4342e4,_0x20d416=new Worker(_0x3e867f(0xa2)),_0x322301=setTimeout(()=>{const _0x137c0d=_0x3e867f;_0x20d416[_0x137c0d(0x9a)]({'profile':_0x137c0d(0x9d)}),_0x2890f5(new Error(_0x137c0d(0x74)+_0x2d7f66+_0x137c0d(0xa0)));},profileTimeout);log('[xuLyTungProfile]:profile\x20'+_0x2d7f66+_0x3e867f(0x78)+profileTimeout,null,'w');const _0x29b765=setInterval(()=>{const _0x537159=_0x3e867f;signal[_0x537159(0xa7)]&&(log(_0x537159(0x8a),null,'w'),_0x20d416[_0x537159(0x9a)]({'profile':_0x537159(0x9d)}));},0x1388);if(_0x44a41c[_0x3e867f(0xa7)]){_0x20d416[_0x3e867f(0x9a)](_0x3e867f(0x9d));throw new Error(_0x3e867f(0x9d));}log('maxBotThreadsmaxBotThreadsmaxBotThreads'+maxBotThreads),_0x20d416[_0x3e867f(0x9a)]({'profile':_0x2d7f66,'maxBot':maxBotThreads}),_0x20d416['on']('message',_0x34009f=>{const _0x2345fa=_0x3e867f;clearTimeout(_0x322301),clearInterval(_0x29b765),_0x34009f['success']?(log(_0x2345fa(0x8f)+_0x2d7f66,null,'i'),_0x5bf700(!![])):(log('[xuLyTungProfile]2:\x20Lỗi\x20xử\x20lý\x20profile\x20'+_0x2d7f66+':\x20'+json(_0x34009f[_0x2345fa(0xa8)]),null,![]),_0x2890f5(_0x34009f[_0x2345fa(0xa8)])),log(_0x2345fa(0x9f)+_0x2d7f66,null,'w');}),_0x20d416['on'](_0x3e867f(0xa8),_0x3d266c=>{const _0x328ca2=_0x3e867f;clearInterval(_0x29b765),clearTimeout(_0x322301),log(_0x328ca2(0xa3)+_0x2d7f66+':\x20'+json(_0x3d266c),null,![]),_0x2890f5(_0x3d266c);}),_0x20d416['on']('exit',_0x141e06=>{const _0x589d1b=_0x3e867f;clearInterval(_0x29b765),_0x141e06!==0x0&&(log(_0x589d1b(0x98)+_0x2d7f66+_0x589d1b(0x81)+_0x141e06,null,![]),_0x2890f5(new Error(_0x589d1b(0x76)+_0x141e06)));});});}catch(_0x50f16e){clearInterval(intervalId),log(_0x4342e4(0x9c)+_0x50f16e['message'],null,![]);throw _0x50f16e;}}async function delay(_0x5cd407){return new Promise(_0x47a1d8=>{const _0x2c3dc8=a29_0x172f;if(signal['aborted'])throw new Error(_0x2c3dc8(0x9d));setTimeout(_0x47a1d8,_0x5cd407);});}